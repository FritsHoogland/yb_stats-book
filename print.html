<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>yb_stats book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="data_sources.html"><strong aria-hidden="true">2.</strong> Data sources</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="upgrade.html"><strong aria-hidden="true">3.1.</strong> Upgrade</a></li></ol></li><li class="chapter-item expanded "><a href="running_yb_stats.html"><strong aria-hidden="true">4.</strong> Running yb_stats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specifying_hosts.html"><strong aria-hidden="true">4.1.</strong> Specifying hosts</a></li><li class="chapter-item expanded "><a href="specifying_ports.html"><strong aria-hidden="true">4.2.</strong> Specifying ports</a></li><li class="chapter-item expanded "><a href="specifying_parallel.html"><strong aria-hidden="true">4.3.</strong> Specifying parallel</a></li><li class="chapter-item expanded "><a href="dotenv.html"><strong aria-hidden="true">4.4.</strong> .env</a></li><li class="chapter-item expanded "><a href="snapshot_results.html"><strong aria-hidden="true">4.5.</strong> yb_stats --snapshot</a></li></ol></li><li class="chapter-item expanded "><a href="output_modes.html"><strong aria-hidden="true">5.</strong> Output modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="snapshot_usage.html"><strong aria-hidden="true">5.1.</strong> Using snapshots</a></li><li class="chapter-item expanded "><a href="filters.html"><strong aria-hidden="true">5.2.</strong> Data filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="filter_hostname_match.html"><strong aria-hidden="true">5.2.1.</strong> --hostname-match</a></li><li class="chapter-item expanded "><a href="filter_stat_name_match.html"><strong aria-hidden="true">5.2.2.</strong> --stat-name-match</a></li><li class="chapter-item expanded "><a href="filter_table_name_match.html"><strong aria-hidden="true">5.2.3.</strong> --table-name-match</a></li></ol></li><li class="chapter-item expanded "><a href="data_enrichment.html"><strong aria-hidden="true">5.3.</strong> Data enrichment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_mode_gauges.html"><strong aria-hidden="true">5.3.1.</strong> --gauges-enable</a></li><li class="chapter-item expanded "><a href="output_mode_details-enable.html"><strong aria-hidden="true">5.3.2.</strong> --details-enable</a></li></ol></li><li class="chapter-item expanded "><a href="adhoc_results.html"><strong aria-hidden="true">5.4.</strong> yb_stats</a></li><li class="chapter-item expanded "><a href="output_mode_snapshot-diff.html"><strong aria-hidden="true">5.5.</strong> yb_stats --snapshot-diff</a></li><li class="chapter-item expanded "><a href="output_mode_versions-diff.html"><strong aria-hidden="true">5.6.</strong> yb_stats --versions-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics.html"><strong aria-hidden="true">5.6.1.</strong> Metrics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_value.html"><strong aria-hidden="true">5.6.1.1.</strong> Value statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsum.html"><strong aria-hidden="true">5.6.1.2.</strong> CountSum statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsumrows.html"><strong aria-hidden="true">5.6.1.3.</strong> CountSumRows statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_statement.html"><strong aria-hidden="true">5.6.1.4.</strong> Statement statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_nodeexporter.html"><strong aria-hidden="true">5.6.1.5.</strong> Node-exporter statistics</a></li><li class="chapter-item expanded "><a href="output_entities_diff.html"><strong aria-hidden="true">5.6.1.6.</strong> Entities diff</a></li><li class="chapter-item expanded "><a href="output_masters_diff.html"><strong aria-hidden="true">5.6.1.7.</strong> Masters diff</a></li><li class="chapter-item expanded "><a href="output_tablet_servers_diff.html"><strong aria-hidden="true">5.6.1.8.</strong> Tablet servers diff</a></li><li class="chapter-item expanded "><a href="output_vars_diff.html"><strong aria-hidden="true">5.6.1.9.</strong> Vars diff</a></li><li class="chapter-item expanded "><a href="output_version_diff.html"><strong aria-hidden="true">5.6.1.10.</strong> Version diff</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="print_mode.html"><strong aria-hidden="true">5.7.</strong> Print modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="print_mode_version.html"><strong aria-hidden="true">5.7.1.</strong> --print-version</a></li><li class="chapter-item expanded "><a href="print_mode_log.html"><strong aria-hidden="true">5.7.2.</strong> --print-log</a></li><li class="chapter-item expanded "><a href="tail_mode_log.html"><strong aria-hidden="true">5.7.3.</strong> --tail-log</a></li><li class="chapter-item expanded "><a href="print_mode_entities.html"><strong aria-hidden="true">5.7.4.</strong> --print-entities</a></li><li class="chapter-item expanded "><a href="print_mode_masters.html"><strong aria-hidden="true">5.7.5.</strong> --print-masters</a></li><li class="chapter-item expanded "><a href="print_mode_tablet_servers.html"><strong aria-hidden="true">5.7.6.</strong> --print-tablet-servers</a></li><li class="chapter-item expanded "><a href="print_mode_vars.html"><strong aria-hidden="true">5.7.7.</strong> --print-vars</a></li><li class="chapter-item expanded "><a href="print_mode_memtrackers.html"><strong aria-hidden="true">5.7.8.</strong> --print-memtrackers</a></li><li class="chapter-item expanded "><a href="print_mode_rpcs.html"><strong aria-hidden="true">5.7.9.</strong> --print-rpcs</a></li><li class="chapter-item expanded "><a href="print_mode_threads.html"><strong aria-hidden="true">5.7.10.</strong> --print-threads</a></li><li class="chapter-item expanded "><a href="print_mode_gflags.html"><strong aria-hidden="true">5.7.11.</strong> --print-gflags</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="crontab.html"><strong aria-hidden="true">6.</strong> Crontab</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">7.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">yb_stats book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="readme"><a class="header" href="#readme">README</a></h1>
<p>Welcome to the <code>yb_stats</code> book.</p>
<p>This is documentation of the <a href="https://github.com/fritshoogland-yugabyte/yb_stats.git">yb_stats project</a>. </p>
<p><code>yb_stats</code> is a CLI tool to query, investigate and extract all facts from a <a href="https://github.com/yugabyte/yugabyte-db.git">YugabyteDB</a> cluster, and store these in CSV files to persist the facts, and make them easy to transport.</p>
<p>The way <code>yb_stats</code> works is that it tries to obtain information from the YugabyteDB and node-exporter http endpoints using the least amount of dependencies, which means using only the <code>yb_stats</code> tool and the http endpoints.</p>
<p>The tools provides 5 general ways of usage:</p>
<ul>
<li>Ad-hoc mode: request and store performance metrics and status data into memory, wait for enter to allow the actions to be investigated to be performed. Pressing enter will request and store the performance metrics and status data into memory again, for which the differences will be shown.</li>
<li>Snapshot mode: request and store all performance metrics and status data to CSV files and display the snapshot number.</li>
<li>Snapshot-diff mode: request the performance metrics and status data from the CSV files from snapshots of two different snapshots, and show the differences. This performs the same output as ad-hoc mode, but the metrics taken from snapshots instead of ad-hoc.</li>
<li>Print snapshot mode: use the print functions with a snapshot number for data to be displayed that is stored in a snapshot, such as version, vars, etc. </li>
<li>Print adhoc mode: use the print functions without a snapshot number for data to be displayed that is stored in a snapshot, such as version, vars, etc. </li>
<li>Raw mode: you can always look into the stored CSV files yourself. However, for two sources of data, there is no function in yb_stats to publish the results: http endpoint <code>/pprof/growth</code> output, and <code>/memz</code> output.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>This is an overview of the data sources, the type of daemon where it comes from, the ports (if default), and the http endpoint it is using.</p>
<div class="table-wrapper"><table><thead><tr><th>Datasource</th><th>Type</th><th>Default Port(s)</th><th>Endpoint</th></tr></thead><tbody>
<tr><td>Metrics</td><td>tserver/master</td><td>7000,9000,12000,13000</td><td>/metrics</td></tr>
<tr><td>Statements</td><td>tserver</td><td>13000</td><td>/statements</td></tr>
<tr><td>Metrics</td><td>node-exporter</td><td>9300</td><td>/metrics</td></tr>
<tr><td>Gflags</td><td>tserver/master</td><td>7000,9000</td><td>/varz</td></tr>
<tr><td>Vars</td><td>tserver/master</td><td>7000,9000</td><td>/api/v1/varz</td></tr>
<tr><td>Threads</td><td>tserver/master</td><td>7000,9000</td><td>/threadz</td></tr>
<tr><td>Mem-trackers</td><td>tserver/master</td><td>7000,9000</td><td>/mem-trackers</td></tr>
<tr><td>Logging</td><td>tserver/master</td><td>7000,9000</td><td>/logs</td></tr>
<tr><td>Version</td><td>tserver/master</td><td>7000,9000</td><td>/api/v1/version</td></tr>
<tr><td>Entities</td><td>master</td><td>7000</td><td>/dump-entities</td></tr>
<tr><td>Masters</td><td>master</td><td>7000</td><td>/api/v1/masters</td></tr>
<tr><td>Tablet-servers</td><td>master</td><td>7000</td><td>/api/v1/tablet-servers</td></tr>
<tr><td>RPCs</td><td>tserver/master</td><td>7000,9000,12000,13000</td><td>/rpcz</td></tr>
<tr><td>Pprof</td><td>tserver/master</td><td>7000,9000</td><td>/pprof/growth</td></tr>
<tr><td>Memory breakdown</td><td>tserver/master</td><td>7000,9000</td><td>/memz</td></tr>
</tbody></table>
</div>
<p>Based on the datasources, these are the options for the differences sources:</p>
<div class="table-wrapper"><table><thead><tr><th>Datasource</th><th>Snapshot</th><th>Ad-hoc</th><th>Diff</th><th>Print snap</th><th>Print ad-hoc</th><th>Raw</th></tr></thead><tbody>
<tr><td>Metrics</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr>
<tr><td>Statement</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr>
<tr><td>Metrics</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr>
<tr><td>Gflags</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Vars</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Thread</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Mem-trackers</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Logging</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Version</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Entities</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Masters</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Tablet-servers</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>RPCs</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Pprof</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td></tr>
<tr><td>Memory breakdown</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td></tr>
</tbody></table>
</div>
<ul>
<li>Snapshot: datasources is captured with the snapshot command.</li>
<li>Ad-hoc: the datasources that are involved in an ad-hoc (non-snapshot) use.</li>
<li>Diff: the datasources that are involved in a snapshot-diff use. This is identical to ad-hoc, but the data taken from snapshots, instead of 'live'.</li>
<li>Print: the datasources that are queryable via a yb_stats print-<datasource> command.</li>
<li>Raw: the datasources that are captured in the snapshot directory, but require reading the file directly, no print or diff command exists.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/data_sources.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="install"><a class="header" href="#install">Install</a></h1>
<h2 id="mac-osx-via-homebrew"><a class="header" href="#mac-osx-via-homebrew">Mac OSX via <a href="https://brew.sh">homebrew</a></a></h2>
<p>Add the yb_stats &quot;brew tap&quot; (which is a github repository):</p>
<pre><code class="language-shell">brew tap fritshoogland-yugabyte/yb_stats
</code></pre>
<p>Install yb_stats:</p>
<pre><code class="language-shell">brew install yb_stats
</code></pre>
<p>yb_stats is available in /usr/local/bin, which should normally be in $PATH.</p>
<h3 id="uninstall-yb_stasts-via-homebrew"><a class="header" href="#uninstall-yb_stasts-via-homebrew">Uninstall yb_stasts via homebrew</a></h3>
<p>Remove yb_stats:</p>
<pre><code class="language-shell">brew uninstall yb_stats
</code></pre>
<p>Remove the yb_stats &quot;brew tap&quot;:</p>
<pre><code class="language-shell">brew untap fritshoogland-yugabyte/yb_stats
</code></pre>
<h2 id="rpm-based-distributions"><a class="header" href="#rpm-based-distributions">RPM based distributions</a></h2>
<p>Install the provided yb_stats RPM via yum:</p>
<p>EL7:</p>
<pre><code class="language-shell">sudo yum install https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.8/yb_stats-0.8.8-1.el7.x86_64.rpm
</code></pre>
<p>EL8:</p>
<pre><code class="language-shell">sudo yum install https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.8/yb_stats-0.8.8-1.el8.x86_64.rpm
</code></pre>
<p>After yum install, yb_stats is available in /usr/local/bin, which should normally be in $PATH.</p>
<p>These are current latest versions. Look <a href="https://github.com/fritshoogland-yugabyte/yb_stats/releases">yb_stats github repository releases page</a> for newer versions.</p>
<h2 id="mac-osx-compile-from-source"><a class="header" href="#mac-osx-compile-from-source">Mac OSX compile from source</a></h2>
<p>Install Rust via rustup:</p>
<pre><code class="language-shell">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>Clone the yb_stats repository:</p>
<pre><code class="language-shell">git clone https://github.com/fritshoogland-yugabyte/yb_stats.git
</code></pre>
<p>Build yb_stats:</p>
<pre><code class="language-shell">cd yb_stats
cargo build --release
</code></pre>
<p>The <code>yb_stats</code> is available in ./target/release/ directory after successful compilation.</p>
<h2 id="linux-compile-from-source"><a class="header" href="#linux-compile-from-source">Linux compile from source</a></h2>
<p>Install dependencies via yum:</p>
<pre><code class="language-shell">sudo yum install -y git openssl-devel gcc
</code></pre>
<p>Install Rust via rustup:</p>
<pre><code class="language-shell">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.sh | sh
</code></pre>
<p>Clone the yb_stats repository:</p>
<pre><code class="language-shell">git clone https://github.com/fritshoogland-yugabyte/yb_stats.git
</code></pre>
<p>Build yb_stats:</p>
<pre><code class="language-shell">cd yb_stats
cargo build --release
</code></pre>
<p>The <code>yb_stats</code> is available in ./target/release/ directory after successful compilation.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/install.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="upgrade"><a class="header" href="#upgrade">Upgrade</a></h1>
<h2 id="warning"><a class="header" href="#warning">Warning</a></h2>
<p>Be aware that when upgrading from a version before 0.9 that the snapshot format has changed.</p>
<ul>
<li>Before <code>yb_stats</code> version 0.9, the snapshot data is stored as CSV.</li>
<li>Starting from <code>yb_stats</code> version 0.9, the snapshot data is stored as JSON.</li>
</ul>
<h2 id="mac-osx-via-homebrew-1"><a class="header" href="#mac-osx-via-homebrew-1">Mac OSX via <a href="https://brew.sh">homebrew</a></a></h2>
<p>This will upgrade the current installed version to the latest available tap version.</p>
<pre><code class="language-shell">brew upgrade yb_stats
</code></pre>
<h2 id="rpm-based-distributions-1"><a class="header" href="#rpm-based-distributions-1">RPM based distributions</a></h2>
<p>EL7:</p>
<pre><code class="language-shell">sudo yum upgrade https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.8/yb_stats-0.8.8-1.el7.x86_64.rpm
</code></pre>
<p>EL8:</p>
<pre><code class="language-shell">sudo yum upgrade https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.8/yb_stats-0.8.8-1.el8.x86_64.rpm
</code></pre>
<p>These are the current latest versions. Look at <a href="https://github.com/fritshoogland-yugabyte/yb_stats/releases">yb_stats github repository releases page</a> for current versions.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/upgrade.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="running-yb_stats"><a class="header" href="#running-yb_stats">Running yb_stats</a></h1>
<p>Once <code>yb_stats</code> is installed, it can be used to get metadata from a YugabyteDB cluster and to create snapshots.</p>
<p>Before <code>yb_stats</code> can be used to create snapshots or perform ad-hoc operations, in other words query data from a YugabyteDB cluster,
the addresses of the endpoints must be specified using the <code>--hosts</code> switch, 
and optionally the <code>--ports</code> switch if ports have been changed 
(see: <a href="./specifying_hosts.html">Specifying hosts</a> and <a href="./specifying_ports.html">Specifying ports</a>),
or the <code>.env</code> file should exist in the current working directory.</p>
<p>If <code>yb_stats</code> is run for obtaining data, which means running in ad-hoc mode, ad-hoc print mode or snapshot mode, 
it must be able to access the YugabyteDB cluster nodes, and be allowed to access the different ports. </p>
<p>If <code>yb_stats</code> is run for investigating snapshots using print mode or snapshot-diff mode, 
there is no need to access the cluster ip addresses or ports, it will use the snapshot CSV data only.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/running_yb_stats.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-hosts"><a class="header" href="#specifying-hosts">Specifying hosts</a></h1>
<p>When <code>yb_stats</code> is used to run in ad-hoc mode, ad-hoc print mode or in snapshot mode, the YugabyteDB cluster nodes must be reachable, and <code>yb_stats</code> must be configured to understand the list of nodes. This is done via the switch <code>--hosts</code>, and requires a comma separated list of ip addresses or hostnames.</p>
<p>The default hosts for <code>yb_stats</code> are 192.168.66.80,192.168.66.81,192.168.66.82. This is unlikely to be the same for your use.</p>
<p>Please mind there should no be spaces between the hostnames or ipaddresses and the comma's.</p>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --hosts 10.1.0.1,10.1.0.2,10.1.03
</code></pre>
<p>The set hosts (as well as ports and parallellism) is stored in the file <code>.env</code> in the current working directory. 
This means that if you have different YugabyteDB clusters you want to use, you either:</p>
<ul>
<li>Need to specify the hosts every usage, which will still create a <code>.env</code> file, but is not used because of the specification.</li>
<li>Use a different directory for each cluster.</li>
</ul>
<p>Using a different directory is highly recommended, especially because then the snapshots will be about the cluster specified only too.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/specifying_hosts.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-ports"><a class="header" href="#specifying-ports">Specifying ports</a></h1>
<p>When <code>yb_stats</code> is used to run in ad-hoc mode, ad-hoc print mode or in snapshot mode, the YugabyteDB cluster nodes must be reachable, and <code>yb_stats</code> must be configured to understand the list of nodes. However, it must also connect to the correct port numbers.</p>
<p>In most cases, the port numbers are kept default. When the port numbers are kept default, there is no need to specify ports, and the default list will be okay. This means that unless one or more default ports have been changed, there is no need to specify ports.</p>
<p>Another reason to specify ports is when for example node-exporter is not installed: specifying the list excluding the node-exporter port YugabyteDB uses (9300) should be done in such a case, although not required.</p>
<p>Please mind the default node-exporter port number is 9000, but that port is taken by the tablet server http endpoint, which is why YugabyteDB uses a different port number for node-exporter.</p>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --ports 7000,9000,12000,13000
</code></pre>
<p>As an example, this list excludes the 9300 port for node-exporter.</p>
<p>The set ports (as well as hosts and parallellism) is stored in the file <code>.env</code> in the current working directory. This means that if you have different YugabyteDB clusters you want to use, you either:</p>
<ul>
<li>Need to speicify the ports every usage, which will still create a <code>.env</code> file, but is not used because of the specification.</li>
<li>use a different directory for each cluster.</li>
</ul>
<p>Using a different directory is highly recommended, especially because then the snapshots will be about the cluster specified only too.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/specifying_ports.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-parallel"><a class="header" href="#specifying-parallel">Specifying parallel</a></h1>
<p>The amount of parallelism can be set using the <code>--parallel</code> switch. By default, <code>yb_stats</code> uses a single thread for performing the work it is doing. For the work done in the code for each different type of datasource and for fetching data from the hosts fetching a specific type of data, it can perform work in parallel.</p>
<p>There is no parallelism for reading the data from the snapshots and presenting it.</p>
<p>Please mind the above description of the way parallelism works in yb_stats means that parallelism is performed at two different points. 
This means that specifying parallelism should be done with great care not to make the parallelism too high.</p>
<p>This is how that works; threads are used for:</p>
<ol>
<li>
<p>Snapshot.
When a snapshot is created, each different <a href="./data_sources.html">datasource</a> is executed by an individual thread in parallel.</p>
</li>
<li>
<p>Requesting a hostname:port combination in a datasource thread.
The thread for each datasource will scan each hostnamer:port combination using a thread. </p>
</li>
</ol>
<p>Step 1 is always done in parallel, and limited by the number of concurrent active parallel threads the executable allows to create.
This means that setting parallelism to will start 3 threads for each datasource, performing requests to 3 hostname:port combinations in each of the threads. 
The reason for this combination is that most of the time in requesting data is spent idle waiting for response.</p>
<p>On MacOS, setting parallel to a too high number can throw errors </p>
<ul>
<li>Number of files/file descriptors (tcp connect error: Too many open files (os error 24))</li>
<li>Number of threads (<code>Err</code> value: ThreadPoolBuildError)
In both cases this can be solved by lowering the value for parallel.
For the <code>Too many open files</code> error, another solution can be to increase the OS/user limit for the number of open files.</li>
</ul>
<p>MacOS: https://gist.github.com/tombigel/d503800a282fcadbee14b537735d202c</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/specifying_parallel.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="env"><a class="header" href="#env">.env</a></h1>
<p>Whenever the <code>yb_stats</code> executable is run with <code>--hosts</code>, <code>--ports</code> or <code>--parallel</code> specified, it will use the value of the flag(s) set, but it will also write the specification of hosts, ports or parallellism into a file called <code>.env</code>.</p>
<p>When <code>yb_stats</code> is executed with a <code>.env</code> file in the current working directory, it will set the environment variables listed in that file. If any of:</p>
<ul>
<li>YBSTATS_HOSTS</li>
<li>YBSTATS_PORTS</li>
<li>YBSTATS_PARALLEL</li>
</ul>
<p>Are set in the <code>.env</code> file, it will use the set value. This way, specifying either or all of the hosts list, ports list or parallellism only need to be done once, and will be set automatically for every next invocation executed from the same directory.</p>
<p>If a flag is specified with <code>yb_stats</code> that is also set in <code>.env</code>, the flag specified with <code>yb_stats</code> will be given preference, and the entry in <code>.env</code> will be overwritten with this new value.</p>
<h1 id="warning-1"><a class="header" href="#warning-1">WARNING</a></h1>
<p>Please mind that if something outside of <code>yb_stats</code> is using <code>.env</code> for its own purposes and sets its own values in the file, 
running <code>yb_stats</code> with the current working directory holding a <code>.env</code> file used by a third party, will <strong>overwrite</strong> the file and only set the <code>yb_stats</code> values, removing any settings not used with <code>yb_stats</code>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/dotenv.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="yb_stats-snapshot-results"><a class="header" href="#yb_stats-snapshot-results">yb_stats snapshot results</a></h1>
<h2 id="directory-yb_statssnapshots"><a class="header" href="#directory-yb_statssnapshots">Directory <code>yb_stats.snapshots</code></a></h2>
<p>When <code>yb_stats</code> is run with the <code>--snapshot</code> mode switch, it will try to find a directory in the current working directory by the name of <code>yb_stats.snaphots</code>. 
If it can't find the directory, it will try to create it. If opening the directory in the case of existence, or creating in the case of non-existence fails, execution will stop with an error indicating the issue.</p>
<h2 id="the-yb_statssnapshotssnapshotindex-file"><a class="header" href="#the-yb_statssnapshotssnapshotindex-file">The <code>yb_stats.snapshots/snapshot.index</code> file</a></h2>
<p>Inside the <code>yb_stats.snapshots</code> directory the first snapshot will create a CSV file called <code>snapshot.index</code>. This file lists the snapshots taken, comma separated with the following fields:</p>
<ul>
<li>snapshot number</li>
<li>snapshot timestamp</li>
<li>snapshot comments</li>
</ul>
<p>Using this file, <code>yb_stats</code> can understand the snapshot numbers, and add one to the highest number for a new snapshot. </p>
<p>Another use of this file is to obtain the first snapshot timestamp for use with snapshot diffs: 
if a second snapshot inserts a metric that is not present in the first snapshot, 
it can safely assume the first snapshot value of that metric to be 0. 
However, it must make a guess about the approximate first snapshot time; which is where the timestamp is used.</p>
<p>A last use of this file is when <code>yb_stats</code> is run with the <code>--snapshot-list</code> switch: <code>yb_stats</code> will list this information, and quit.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>This is how a typical snapshot is performed:</p>
<pre><code class="language-shell">% yb_stats --snapshot
snapshot number 0
</code></pre>
<h2 id="error"><a class="header" href="#error">Error</a></h2>
<p>If the current working directory is not writable, it will provide the following error:</p>
<pre><code class="language-shell">[2022-11-30T10:59:18Z ERROR yb_stats::snapshot] Fatal: error creating directory /Users/fritshoogland/Downloads/t/yb_stats.snapshots: Permission denied (os error 13)
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/snapshot_results.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="output-modes"><a class="header" href="#output-modes">Output modes</a></h1>
<p>The output that <code>yb_stat</code> provides can roughly be divided into 3 categories:</p>
<ul>
<li>Information that is obtained from stored snapshots, which is formatted for readability.</li>
<li>Information that is obtained from the live cluster, which is formatted for readability.</li>
<li>Raw output provided in a text file, which is obtained at snapshot time. This is not printed, the resulting file can be used.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_modes.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="snapshot-usage"><a class="header" href="#snapshot-usage">Snapshot usage</a></h1>
<p>The locally stored snapshots must be available in the following way:</p>
<ul>
<li>The directory <code>yb_stats.snapshots</code> must be present and executable in the current working directory.</li>
<li>The directory <code>yb_stats.snapshots</code> must contain a file called <code>snapshot.index</code>.</li>
<li>The <code>snapshot.index</code> file must list all the available snapshots.</li>
<li>The snapshots listed in <code>snapshot.index</code> must be available as directory with the snapshot number as directory name inside the <code>yb_stats.snapshots</code> directory.</li>
<li>Inside the snapshot directory, the files containing the JSON data that make the snapshot must be present.</li>
</ul>
<p>All the files in all the snapshots are UTF8 JSON files, and therefore can be easily transported. 
This means you don't have to use the same computer to view the snapshot output: if the <code>yb_stats.snapshot</code> directory and its contents are zipped, they can be copied and shared.
This means you can unzip a snapshots file, and investigate it on your own computer, without the need for access to the cluster where the snapshots came from.</p>
<h2 id="security-restrictions"><a class="header" href="#security-restrictions">Security restrictions</a></h2>
<p>Because the snapshots are UTF8 JSON files, the files can be inspected by security officers to inspect existence of security issues or secret data.</p>
<p><code>yb_stats</code> does only store cluster metadata, no actual data. <code>yb_stats</code> does store (part of) the logfiles, so these potentially can report actual data.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/snapshot_usage.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="filters"><a class="header" href="#filters">filters</a></h1>
<p>Filter can be used for showing data, and are never used for creating snapshots.</p>
<p>To be more concrete, filters can be used with the following usage:</p>
<ul>
<li>No switches/ad-hoc mode.</li>
<li>Snapshot-diff mode.</li>
<li>Print modes, depending on the print topic.</li>
</ul>
<p>Filters usage regular expressions for optimal flexibility.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/filters.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="--hostname-match"><a class="header" href="#--hostname-match">--hostname-match</a></h1>
<p>Most <code>yb_stats</code> query options allow to filter on hostname. This is done with the <code>--hostname-match</code> switch. The hostname match switch uses a regex to filter out entries using the hostname:port specification.</p>
<p>Very simple use of <code>--hostname-match</code> is to filter on the port number, to specify only the tablet servers:</p>
<pre><code class="language-shell">yb_stats --hostname-match 9000
</code></pre>
<p>Or specify to use only the tablet server and master servers, thereby filtering the node-exporter, YEDIS, YCQL and YSQL output:</p>
<pre><code class="language-shell">yb_stats --hostname-match '(7000|9000)'
</code></pre>
<p>Because the filter is based on regex pattern matching, it is also easy to specify a master (=7000) for a class C ip network with hostnumber 82 (class C means for example 192.168.66/24, so one octet remains, so '82'), which means you can filter in this way:</p>
<pre><code class="language-shell">yb_stats --hostname-match '82:7000'
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/filter_hostname_match.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="--stat-name-match"><a class="header" href="#--stat-name-match">--stat-name-match</a></h1>
<p>For the statistic names with the performance metrics for a memory or snapshot diff, as well as for the gflags name and mem-trackers id values, it is possible to filter. The filter name for that is <code>--stat-name-match</code>. This is a regex for filtering.</p>
<p>For example if you are only interested in master and tserver cpu statistics:</p>
<pre><code class="language-shell">yb_stats --stat-name-match 'cpu_.time'
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.900 seconds
192.168.66.80:12000  server   cpu_stime                              15 ms              16.502 /s
192.168.66.80:7000   server   cpu_stime                               2 ms               2.200 /s
192.168.66.80:7000   server   cpu_utime                               8 ms               8.801 /s
192.168.66.80:9000   server   cpu_stime                              14 ms              15.402 /s
192.168.66.81:12000  server   cpu_stime                               6 ms               6.608 /s
192.168.66.81:12000  server   cpu_utime                               9 ms               9.912 /s
192.168.66.81:7000   server   cpu_stime                               8 ms               8.801 /s
192.168.66.81:9000   server   cpu_stime                               7 ms               7.709 /s
192.168.66.81:9000   server   cpu_utime                               9 ms               9.912 /s
192.168.66.82:12000  server   cpu_stime                               6 ms               6.645 /s
192.168.66.82:12000  server   cpu_utime                              10 ms              11.074 /s
192.168.66.82:7000   server   cpu_utime                               8 ms               8.840 /s
192.168.66.82:9000   server   cpu_stime                               6 ms               6.637 /s
192.168.66.82:9000   server   cpu_utime                              11 ms              12.168 /s
</code></pre>
<p>Or a more sophisticated filter to look at tserver and master cpu time, as well as voluntary and involuntary context switches:</p>
<pre><code class="language-shell">yb_stats --stat-name-match '(cpu_.time|voluntary_context_switches)'
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.915 seconds
192.168.66.80:12000  server   cpu_utime                               12 ms              13.086 /s
192.168.66.80:12000  server   voluntary_context_switches             234 csws           255.180 /s
192.168.66.80:7000   server   cpu_stime                                2 ms               2.181 /s
192.168.66.80:7000   server   cpu_utime                                9 ms               9.815 /s
192.168.66.80:7000   server   voluntary_context_switches             105 csws           114.504 /s
192.168.66.80:9000   server   cpu_utime                                13 ms              14.177 /s
192.168.66.80:9000   server   voluntary_context_switches             235 csws           256.270 /s
192.168.66.81:12000  server   cpu_stime                                6 ms               6.550 /s
192.168.66.81:12000  server   cpu_utime                                8 ms               8.734 /s
192.168.66.81:12000  server   voluntary_context_switches             262 csws           286.026 /s
192.168.66.81:7000   server   cpu_utime                                7 ms               7.625 /s
192.168.66.81:7000   server   voluntary_context_switches              70 csws            76.253 /s
192.168.66.81:9000   server   cpu_stime                                6 ms               6.543 /s
192.168.66.81:9000   server   cpu_utime                                8 ms               8.724 /s
192.168.66.81:9000   server   voluntary_context_switches             263 csws           286.805 /s
192.168.66.82:12000  server   cpu_stime                                6 ms               6.565 /s
192.168.66.82:12000  server   cpu_utime                                8 ms               8.753 /s
192.168.66.82:12000  server   voluntary_context_switches             272 csws           297.593 /s
192.168.66.82:7000   server   cpu_utime                                8 ms               8.762 /s
192.168.66.82:7000   server   voluntary_context_switches              65 csws            71.194 /s
192.168.66.82:9000   server   cpu_stime                                6 ms               6.565 /s
192.168.66.82:9000   server   cpu_utime                                8 ms               8.753 /s
192.168.66.82:9000   server   voluntary_context_switches             269 csws           294.311 /s
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/filter_stat_name_match.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="--table-name-match"><a class="header" href="#--table-name-match">--table-name-match</a></h1>
<p><code>yb_stats</code> by default sums up per table and tablet statistics per hostname-port number combination, to try to sensibly reduce the amount of output. However, <code>yb_stats</code> can be set to display per table and tablet statistics individually using the <code>--details-enable</code> switch.</p>
<p>If the <code>--details-enable</code> switch is set, the table name is stored with the statistics for both the table and tablet data. The <code>--table-name-match</code> switch allows you to filter on the table name, to have the ability to look at the statistics of only the tables of interest.</p>
<p>Additionally, the <code>--table-name-match</code> switch can also be used for the printing the details of the entities data, which also are tables.</p>
<p>Example: filter for the sys.catalog (postgres catalog) entries in the master. Please mind the <code>--hostname-match</code> option is also used, because otherwise the node-exporter output would still be shown, because that data is not filtered by <code>--table-name-match</code></p>
<pre><code class="language-shell">yb_stats --details-enable --table-name-match catalog --hostname-match 7000
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.679 seconds

Begin ad-hoc in-memory snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    1.621 seconds
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_bytes_read                                                 4095007 bytes      2545063.393 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_data_hit                                                        97 blocks          60.286 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_hit                                                            172 blocks         106.899 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_index_hit                                                       75 blocks          46.613 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_single_touch_bytes_read                                    4095007 bytes      2545063.393 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_single_touch_hit                                               172 blocks         106.899 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_db_iter_bytes_read                                                     1353537 bytes       841228.713 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_no_table_cache_iterators                                                    48 iters           29.832 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_next                                                            2180 keys          1354.879 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_next_found                                                      2225 keys          1382.846 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_seek                                                             131 keys            81.417 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_seek_found                                                       122 keys            75.823 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_superversion_acquires                                                 4 nr               2.486 /s
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/filter_table_name_match.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="data-enrichment"><a class="header" href="#data-enrichment">Data enrichment</a></h1>
<p>Despite <code>yb_stats</code> providing a lot of output, it still is trying to reduce the total amount of data. 
There are two options for increasing the amount of data: by adding gauge data, and by showing the original, non-summarized data for tables, tablets and cdc (change data capture) statistics.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/data_enrichment.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="--gauges-enable"><a class="header" href="#--gauges-enable">--gauges-enable</a></h1>
<p>The default output for metrics shows the values of metrics of the type <em>counter</em>. Counters are ever increasing values. In most cases, a counter value on itself is not that useful, but the difference between two points in time is. That is the reason metrics requires two snapshots: to have the ability to calculate the difference, and thus understand how much a counter has changed.</p>
<p>But, there are also metrics that show absolute values, for which the value is not ever increasing, but instead just shows the current situation. This means that the difference between two points in time does not provide the same meaning as for a counter. The difference between the two points in time for absolute values can still be important. Such as value is called a gauge.</p>
<p>By default, <code>yb_stats</code> does NOT show gauge values. To make <code>yb_stats</code> show gauge values additional to the counters, is using the <code>--gauges-enable</code> switch.</p>
<p>This is <code>yb_stats</code> in ad-hoc mode (not showing gauges):</p>
<pre><code class="language-shell">yb_stats
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    1.019 seconds
192.168.66.80:12000  server   cpu_stime                                                                            2 ms               2.200 /s
192.168.66.80:12000  server   cpu_utime                                                                           13 ms              14.301 /s
192.168.66.80:12000  server   server_uptime_ms                                                                   910 ms            1001.100 /s
192.168.66.80:12000  server   voluntary_context_switches                                                         233 csws           256.326 /s
</code></pre>
<p>This is <code>yb_stats</code> in ad-hoc mode showing gauges:</p>
<pre><code class="language-shell">yb_stats --gauges-enable
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    1.053 seconds
192.168.66.80:12000  server   cpu_stime                                                                            2 ms               1.927 /s
192.168.66.80:12000  server   cpu_utime                                                                           13 ms              12.524 /s
192.168.66.80:12000  server   generic_current_allocated_bytes                                               26914872 bytes            +1120
192.168.66.80:12000  server   generic_heap_size                                                             43188224 bytes               +0
192.168.66.80:12000  server   hybrid_clock_error                                                              500000 us                  +0
192.168.66.80:12000  server   hybrid_clock_hybrid_time                                               6824678428388270080 us         +4253745152
192.168.66.80:12000  server   server_uptime_ms                                                                  1038 ms            1000.000 /s
192.168.66.80:12000  server   tcmalloc_current_total_thread_cache_bytes                                      2560384 bytes          +137976
192.168.66.80:12000  server   tcmalloc_max_total_thread_cache_bytes                                         33554432 bytes               +0
192.168.66.80:12000  server   tcmalloc_pageheap_free_bytes                                                   3579904 bytes           -90112
192.168.66.80:12000  server   tcmalloc_pageheap_unmapped_bytes                                               7847936 bytes            -8192
192.168.66.80:12000  server   threads_running                                                                     45 threads              +0
192.168.66.80:12000  server   threads_running_CQLServer_reactor                                                    1 threads              +0
192.168.66.80:12000  server   threads_running_acceptor                                                             1 threads              +0
192.168.66.80:12000  server   threads_running_iotp_CQLServer                                                       4 threads              +0
192.168.66.80:12000  server   threads_running_rpc_thread_pool                                                     15 threads              +0
192.168.66.80:12000  server   voluntary_context_switches                                                         294 csws           283.237 /s
</code></pre>
<p>The gauge values can be spotted because they do not end with '/s', because they do not show its value per second. Instead, the first value is the value of the END snapshot, and the second value is the difference with the FIRST snapshot.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_mode_gauges.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="--details-enable"><a class="header" href="#--details-enable">--details-enable</a></h1>
<p>By default, statistics of the metric_types table, tablet and cdc are summed by metric_type and statistic name. This is done to reduce the amount of output in an as sensible way as possible without harming facts and truth.</p>
<p>However, sometimes it is necessary to split up the statistics per metric_type to understand metrics about specific table, tablet or cdc metric_types statistics. This can be done using the <code>--details-enable</code> switch. This switch introduces a few more columns in the output to detail the table, tablet or cdc metric type statistics.</p>
<p>This is how the regular output looks like:</p>
<pre><code class="language-shell">yb_stats --snapshot-diff -b 0 -e 1 --hostname-match 82:7000 --stat-name-match rocksdb
192.168.66.81:7000   tablet   rocksdb_block_cache_bytes_read                                                11760999 bytes       865351.998 /s
192.168.66.81:7000   tablet   rocksdb_block_cache_data_hit                                                       255 blocks          18.762 /s
192.168.66.81:7000   tablet   rocksdb_block_cache_hit                                                            548 blocks          40.321 /s
192.168.66.81:7000   tablet   rocksdb_block_cache_index_hit                                                      293 blocks          21.558 /s
192.168.66.81:7000   tablet   rocksdb_block_cache_single_touch_bytes_read                                   11760999 bytes       865351.998 /s
192.168.66.81:7000   tablet   rocksdb_block_cache_single_touch_hit                                               548 blocks          40.321 /s
192.168.66.81:7000   tablet   rocksdb_db_iter_bytes_read                                                     1695826 bytes       124775.660 /s
192.168.66.81:7000   tablet   rocksdb_no_table_cache_iterators                                                   193 iters           14.201 /s
192.168.66.81:7000   tablet   rocksdb_number_db_next                                                            2783 keys           204.768 /s
192.168.66.81:7000   tablet   rocksdb_number_db_next_found                                                      2783 keys           204.768 /s
192.168.66.81:7000   tablet   rocksdb_number_db_seek                                                             268 keys            19.719 /s
192.168.66.81:7000   tablet   rocksdb_number_db_seek_found                                                       257 keys            18.910 /s
192.168.66.81:7000   tablet   rocksdb_number_superversion_acquires                                                 3 nr               0.221 /s
</code></pre>
<p>This is filtered down to statistics that are happening on the tablet metric type.</p>
<p>This is how that output looks like when <code>--details-enable</code> is added:</p>
<pre><code class="language-shell">yb_stats --snapshot-diff -b 0 -e 1 --hostname-match 82:7000 --stat-name-match rocksdb --details-enable
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_bytes_read                                                11760999 bytes       865351.998 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_data_hit                                                       255 blocks          18.762 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_hit                                                            548 blocks          40.321 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_index_hit                                                      293 blocks          21.558 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_single_touch_bytes_read                                   11760999 bytes       865351.998 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_block_cache_single_touch_hit                                               548 blocks          40.321 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_db_iter_bytes_read                                                     1695826 bytes       124775.660 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_no_table_cache_iterators                                                   193 iters           14.201 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_next                                                            2783 keys           204.768 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_next_found                                                      2783 keys           204.768 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_seek                                                             268 keys            19.719 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_db_seek_found                                                       257 keys            18.910 /s
192.168.66.81:7000   tablet   00000000000000000000000000000000 sys.catalog                    rocksdb_number_superversion_acquires                                                 3 nr               0.221 /s
</code></pre>
<p>In this case, the statistics were generated by a single tablet. However if multiple tablets were involved, the statistics for all of these would be shown.
The <code>--details-enable</code> switch introduces a couple of extra columns:</p>
<ul>
<li>A column for the UUID or number of the metric object</li>
<li>A column that shows the namespace and the object name.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_mode_details-enable.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="yb_stats-ad-hoc-results"><a class="header" href="#yb_stats-ad-hoc-results">yb_stats ad-hoc results</a></h1>
<p>When <code>yb_stats</code> is run without any switch, or only the data or filter switches, it will perform a snapshot in memory, and wait for enter to perform the next snapshot and present the difference.
This is called 'ad-hoc mode'.</p>
<p>This will not only show the difference for performance based statistics (the metric counters and optionally gauges), but also any change in the cluster, such as:</p>
<ul>
<li>The addition or removal of tablet servers or masters.</li>
<li>Restarts of tablet servers or masters.</li>
<li>The creation or removal of database objects (tables, indexes, materialized views, databases/keyspaces).</li>
<li>The change of any gflags of the tablet servers or masters.</li>
<li>Any change for a replica, notably the LEADER or FOLLOWER state.</li>
<li>Role changes for the masters.</li>
</ul>
<p>The usage of either ad-hoc mode or snapshot mode should be carefully considered. 
ad-hoc alias in-memory snapshots does not write anything. 
In most cases performing snapshots persisting all the available information is the best way, so results can be reviewed later, and cannot get lost, because they are stored.
However, if you are performing repeated tests where storing all snapshot information would simply be too much and would require you to remove all the snapshots after testing anyways AND you are shure what to look for, then ad-hoc mode might be used.</p>
<h1 id="example-1"><a class="header" href="#example-1">Example</a></h1>
<p>This is how the first snapshot looks like in ad-hoc mode:</p>
<pre><code>% yb_stats
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.
</code></pre>
<p>After the snapshot is created, you can perform the task under investigation. Once that is done, press enter:</p>
<pre><code>
Time between snapshots:   70.166 seconds
192.168.66.80:12000  server   cpu_stime                                                                          874 ms              12.458 /s
192.168.66.80:12000  server   cpu_utime                                                                            7 ms               0.100 /s
...etcetera
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/adhoc_results.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="snapshot-diff-mode"><a class="header" href="#snapshot-diff-mode">snapshot-diff mode</a></h1>
<p>The purpose of snapshot-diff mode is to read two snapshots which must be locally stored, and show a difference report.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--stat-name-match</code>: filter by statistic name regular expression.</li>
<li><code>--table-name-match</code>: filter by table name regular expression (requires <code>--details-enable</code> to split table and tablet statistics out).</li>
<li><code>--details-enable</code>: split table and tablet statistics, instead of summarizing these per server.</li>
<li><code>--gauges-enable</code>: add non-counter statistics to the output.</li>
<li><code>-b</code>/<code>--begin</code>: set the begin snapshot number.</li>
<li><code>-e</code>/<code>--end</code>: set the end snapshot number.</li>
</ul>
<p>snapshot-diff mode means using already stored snapshots, which can be from a cluster that currently is unavailable or even deleted, because the snapshot-diff mode only uses the information that is stored in the locally available snapshot (CSV) data.
This gives a lot of options for investigation that otherwise would be hard or painful, and allows to investigate airgapped clusters (clusters that are not connected to the internet). </p>
<p>The way to invoke snapshot-diff mode is to use the <code>--snapshot-diff</code> switch. </p>
<p>If <code>--snapshot-diff</code> is used without <code>-b</code>/<code>--begin</code> <snapshot number> and <code>-e</code>/<code>--end</code> <snapshot number> options, it will present the available snapshot numbers with their timestamp and comments and ask for the option that is not specified. Otherwise the snapshot-diff is directly created and shown.</p>
<p>snapshot-diff without begin/end specification:</p>
<pre><code class="language-shell">yb_stats --snapshot-diff
  0 2022-10-17 19:50:58.048195 +02:00
  1 2022-10-17 19:52:34.413494 +02:00 second snap
  2 2022-10-18 15:26:20.061213 +02:00
Enter begin snapshot: 0
Enter end snapshot: 1
192.168.66.80:12000  server   cpu_stime                                                                          654 ms               6.792 /s
192.168.66.80:12000  server   cpu_utime                                                                          311 ms               3.230 /s
192.168.66.80:12000  server   involuntary_context_switches                                                         1 csws             0.010 /s
192.168.66.80:12000  server   server_uptime_ms                                                                 96292 ms            1000.000 /s
192.168.66.80:12000  server   threads_started                                                                      4 threads           0.042 /s
192.168.66.80:12000  server   threads_started_thread_pool                                                          4 threads           0.042 /s
192.168.66.80:12000  server   voluntary_context_switches                                                       21821 csws           226.613 /s
</code></pre>
<p>snapshot-diff with begin/end specification:</p>
<pre><code class="language-shell">yb_stats --snapshot-diff -b 0 -e 1
192.168.66.80:12000  server   cpu_stime                                                                          654 ms               6.792 /s
192.168.66.80:12000  server   cpu_utime                                                                          311 ms               3.230 /s
192.168.66.80:12000  server   involuntary_context_switches                                                         1 csws             0.010 /s
192.168.66.80:12000  server   server_uptime_ms                                                                 96292 ms            1000.000 /s
192.168.66.80:12000  server   threads_started                                                                      4 threads           0.042 /s
192.168.66.80:12000  server   threads_started_thread_pool                                                          4 threads           0.042 /s
192.168.66.80:12000  server   voluntary_context_switches                                                       21821 csws           226.613 /s
...etc...
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_mode_snapshot-diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="versions-diff-mode"><a class="header" href="#versions-diff-mode">versions-diff mode</a></h1>
<p>The purpose of versions-diff mode is to read two snapshots which must be locally stored, and show a difference report.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>-b</code>/<code>--begin</code>: set the begin snapshot number.</li>
<li><code>-e</code>/<code>--end</code>: set the end snapshot number.</li>
</ul>
<p>versions-diff mode means using already stored snapshots, which can be from a cluster that currently is unavailable or even deleted, because the versions-diff mode only uses the information that is stored in the locally available snapshot (CSV) data.
This gives a lot of options for investigation that otherwise would be hard or painful, and allows to investigate airgapped clusters (clusters that are not connected to the internet). </p>
<p>The way to invoke versions-diff mode is to use the <code>--versions-diff</code> switch. </p>
<p>If <code>--versions-diff</code> is used without <code>-b</code>/<code>--begin</code> <snapshot number> and <code>-e</code>/<code>--end</code> <snapshot number> options, it will present the available snapshot numbers with their timestamp and comments and ask for the option that is not specified. Otherwise the versions-diff is directly created and shown.</p>
<p>versions-diff without begin/end specification:</p>
<pre><code class="language-shell">yb_stats --versions-diff
  0 2022-12-08 16:42:01.226043 +01:00
  1 2022-12-09 16:34:08.057222 +01:00
  2 2022-12-10 16:07:57.948800 +01:00
  3 2022-12-10 21:39:04.439287 +01:00
  4 2022-12-10 21:39:33.664075 +01:00
  5 2022-12-10 21:42:56.852644 +01:00
  6 2022-12-10 21:43:00.348445 +01:00
Enter begin snapshot: 5
Enter end snapshot: 6

</code></pre>
<p>No output means there is no version difference between the two snapshots.</p>
<p>versions-diff with begin/end specification:</p>
<pre><code class="language-shell">yb_stats --snapshot-diff -b 0 -e 1
* 192.168.66.80:7000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
* 192.168.66.80:9000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
* 192.168.66.81:7000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
* 192.168.66.81:9000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
* 192.168.66.82:7000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
* 192.168.66.82:9000   Versions: 2.15.3.2-&gt;2.17.0.0 b1-&gt;b24 RELEASE 04 Nov 2022 16:53:01 UTC-&gt;16 Nov 2022 00:21:52 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14-&gt;d4f01a5e26b168585e59f9c1a95766ffdd9655b1
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_mode_versions-diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="metrics"><a class="header" href="#metrics">Metrics</a></h1>
<p>The metrics related output always uses two snapshots. </p>
<ul>
<li>Ad-hoc mode performs the snapshots live and stores the results in memory, and doesn't write any file. </li>
<li>Snapshot-diff mode takes local available previously taken snapshots.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="value-statistics"><a class="header" href="#value-statistics">Value statistics</a></h1>
<p>In the output generated by ad-hoc or snapshot-diff mode, the first group of statistics shown are value statistics. 
The captured statistics are essentially a statistic name, and a statistic value. 
The values to be displayed are ordered by hostname, metric_type and statistic name.</p>
<p>By default, <code>counters</code> are shown, for which the value is the difference between the end and begin values.</p>
<ul>
<li>If a counter is zero during both the begin and end snapshot, the statistic is skipped.</li>
<li>If a counter is non-zero and existing in the end snapshot, and the statistic is not existing in the begin snapshot, the end snapshot value is taken as value.</li>
<li>If a counter is non-zero and existing in the begin snapshot, and not existing in the end snapshot, the value is skipped.</li>
<li>If a counter is non-zero in the begin and end snapshots, but subtracting leads to zero, then the statistic is not printed. Supposedly nothing happened, but previously something happened.</li>
<li>If a counter is non-zero in the begin and end snapshots, but the end value is lower than the begin value: this is a suspicious situation. Currently the resulting negative value is shown. </li>
</ul>
<h1 id="counters"><a class="header" href="#counters">counters</a></h1>
<p>This is how value statistic output looks like:</p>
<pre><code>192.168.66.80:12000  server   cpu_stime                                                                            5 ms               6.188 /s
192.168.66.80:12000  server   cpu_utime                                                                            9 ms              11.139 /s
192.168.66.80:12000  server   server_uptime_ms                                                                   807 ms             998.762 /s
192.168.66.80:12000  server   voluntary_context_switches                                                         217 csws           268.564 /s
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>statistic name</th><th>value</th><th>unit</th><th>value / snapshot time (s)</th></tr></thead><tbody>
<tr><td>192.168.66.80:12000</td><td>server</td><td>cpu_stime</td><td>5</td><td>ms</td><td>6.188 /s</td></tr>
<tr><td>192.168.66.80:12000</td><td>server</td><td>cpu_utime</td><td>9</td><td>ms</td><td>11.139 /s</td></tr>
<tr><td>192.168.66.80:12000</td><td>server</td><td>server_uptime_ms</td><td>807</td><td>ms</td><td>998.762 /s</td></tr>
<tr><td>192.168.66.80:12000</td><td>server</td><td>voluntary_context_switches</td><td>217</td><td>csws</td><td>268.564 /s</td></tr>
</tbody></table>
</div>
<h1 id="gauges"><a class="header" href="#gauges">gauges</a></h1>
<p>If the <code>--gauges-enable</code> switch is used, gauge values are shown alongside counter values.
A gauge value is a value that can get higher and lower during its runtime.
Therefore, we show the end value of such a value, and show the difference with the begin snapshot value with plus and minus.</p>
<ul>
<li>If a gauge is zero during both the begin and end snapshot, the statistic is skipped.</li>
<li>If a gauge is non-zero and existing in the end snapshot, and the statistic is not existing in the begin snapshot, the end snapshot value is taken as value.</li>
<li>If a gauge is non-zero and existing in the begin snapshot, and not existing in the end snapshot, the value is skipped.</li>
<li>if a gauge is non-zero in the begin and end snapshots, and subtracting leads to zero, the value is printed(!).</li>
</ul>
<p>This is how that looks like:</p>
<pre><code>192.168.66.80:12000  server   cpu_stime                                                                           10 ms              10.893 /s
192.168.66.80:12000  server   cpu_utime                                                                            5 ms               5.447 /s
192.168.66.80:12000  server   generic_current_allocated_bytes                                               26908008 bytes           +25472
192.168.66.80:12000  server   generic_heap_size                                                             43188224 bytes               +0
192.168.66.80:12000  server   hybrid_clock_error                                                              500000 us                  +0
192.168.66.80:12000  server   hybrid_clock_hybrid_time                                               6824687165143556096 us         +3762429952
192.168.66.80:12000  server   server_uptime_ms                                                                   918 ms            1000.000 /s
192.168.66.80:12000  server   tcmalloc_current_total_thread_cache_bytes                                      2675304 bytes          +124184
192.168.66.80:12000  server   tcmalloc_max_total_thread_cache_bytes                                         33554432 bytes               +0
192.168.66.80:12000  server   tcmalloc_pageheap_free_bytes                                                   1228800 bytes           -90112
192.168.66.80:12000  server   tcmalloc_pageheap_unmapped_bytes                                               9977856 bytes               +0
192.168.66.80:12000  server   threads_running                                                                     47 threads              +0
192.168.66.80:12000  server   threads_running_CQLServer_reactor                                                    1 threads              +0
192.168.66.80:12000  server   threads_running_acceptor                                                             1 threads              +0
192.168.66.80:12000  server   threads_running_iotp_CQLServer                                                       4 threads              +0
192.168.66.80:12000  server   threads_running_rpc_thread_pool                                                     15 threads              +0
192.168.66.80:12000  server   voluntary_context_switches                                                         262 csws           285.403 /s
</code></pre>
<p>These are a gauge values:</p>
<pre><code>192.168.66.80:12000  server   generic_current_allocated_bytes                                               26908008 bytes           +25472
192.168.66.80:12000  server   generic_heap_size                                                             43188224 bytes               +0
192.168.66.80:12000  server   hybrid_clock_error                                                              500000 us                  +0
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>statistic name</th><th>value</th><th>unit</th><th>end value - begin value</th></tr></thead><tbody>
<tr><td>192.168.66.80:12000</td><td>server</td><td>generic_current_allocated_bytes</td><td>26908008</td><td>bytes</td><td>+25472</td></tr>
<tr><td>192.168.66.80:12000</td><td>server</td><td>generic_heap_size</td><td>43188224</td><td>bytes</td><td>+0</td></tr>
<tr><td>192.168.66.80:12000</td><td>server</td><td>hybrid_clock_error</td><td>500000</td><td>us</td><td>+0</td></tr>
</tbody></table>
</div>
<h1 id="details"><a class="header" href="#details">details</a></h1>
<p>For the metric_types of <code>table</code>, <code>tablet</code> and <code>cdc</code>, the statistics are kept per <code>table</code>, <code>tablet</code> or <code>cdc</code> object. 
To reduce the amount of data shown, these by default are summed together per server.
If the <code>--details-enable</code> switch is used, the output changes to include metric_id, namespace and object_name. 
This allows seeing the statistics per individual object.
This is how that looks like:</p>
<pre><code>192.168.66.80:9000   server   -               -               -                              tcp_bytes_received                                                               75765 bytes         4293.608 /s
192.168.66.80:9000   server   -               -               -                              tcp_bytes_sent                                                                   80901 bytes         4584.665 /s
192.168.66.80:9000   server   -               -               -                              threads_started                                                                      5 threads           0.283 /s
192.168.66.80:9000   server   -               -               -                              transaction_pool_cache_queries                                                       1 qry              0.057 /s
192.168.66.80:9000   server   -               -               -                              voluntary_context_switches                                                        6232 csws           353.168 /s
192.168.66.80:9000   tablet   d3265ac130b2b1f yugabyte        t                              log_bytes_logged                                                                   403 bytes           22.838 /s
192.168.66.80:9000   tablet   d3265ac130b2b1f yugabyte        t                              rocksdb_bytes_written                                                               12 bytes            0.677 /s
192.168.66.80:9000   tablet   d3265ac130b2b1f yugabyte        t                              rocksdb_sequence_number                                                              2 rows             0.113 /s
192.168.66.80:9000   tablet   d3265ac130b2b1f yugabyte        t                              rocksdb_write_self                                                                   1 writes           0.056 /s
192.168.66.80:9000   tablet   d3265ac130b2b1f yugabyte        t                              rows_inserted                                                                        2 rows             0.113 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         log_bytes_logged                                                                   389 bytes           22.045 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rocksdb_bytes_written                                                               12 bytes            0.677 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rocksdb_number_db_seek                                                               1 keys             0.057 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rocksdb_number_superversion_acquires                                                 1 nr               0.057 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rocksdb_sequence_number                                                              1 rows             0.057 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rocksdb_write_self                                                                   1 writes           0.056 /s
192.168.66.80:9000   tablet   97122de784c10a3 yugabyte        i_t_f1                         rows_inserted                                                                        1 rows             0.056 /s
192.168.66.80:9000   tablet   654e97ca348833d system          transactions                   log_bytes_logged                                                                  1199 bytes           67.947 /s
192.168.66.80:9000   tablet   04d3aadfcc0c75e system          transactions                   log_bytes_logged                                                                   395 bytes           22.385 /s
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>object_id</th><th>namespace</th><th>object name</th><th>statistic name</th><th>value</th><th>unit</th><th>value / snapshot time (s)</th></tr></thead><tbody>
<tr><td>192.168.66.80:9000</td><td>server</td><td>-</td><td>-</td><td>-</td><td>tcp_bytes_received</td><td>75765</td><td>bytes</td><td>4293.608 /s</td></tr>
<tr><td>192.168.66.80:9000</td><td>tablet</td><td>d3265ac130b2b1f</td><td>yugabyte</td><td>t</td><td>log_bytes_logged</td><td>403</td><td>bytes</td><td>22.838 /s</td></tr>
<tr><td>192.168.66.80:9000</td><td>tablet</td><td>654e97ca348833d</td><td>system</td><td>transactions</td><td>log_bytes_logged</td><td>1199</td><td>bytes</td><td>67.947 /s</td></tr>
</tbody></table>
</div>
<p>The columns added are the third, fourth and fifth columns. </p>
<ul>
<li>The third column shows the metric_id, which for the tablet is the tablet UUID, for the a table is table_id, and for cdc is ?. The snapshot stores the full metric_id, the length shown is 15 characters.</li>
<li>The sixth column shows the object_name (it says 'table_name' in the attributes in the metric page, but an object can be an index or materialized view too).</li>
<li>A 'server' metric_type does not carry meaningful a meaningful value in 'metric_id', and the namespace_name and object name is not present. Therefore, for server a '-' is shown. </li>
</ul>
<h1 id="details-and-gauges"><a class="header" href="#details-and-gauges">details and gauges</a></h1>
<p>The switches <code>--details-enable</code> and <code>--gauges-enable</code> work individually, but do influence each other.
This means that when <code>--gauges-enable</code> is set, <code>--details-enable</code> will also show gauge data per <code>table</code>, <code>tablet</code> or <code>cdc</code> object:</p>
<pre><code>192.168.66.80:9000   server   -               -               -                              tcp_bytes_received                                                                4694 bytes         3684.458 /s
192.168.66.80:9000   server   -               -               -                              tcp_bytes_sent                                                                    4101 bytes         3218.995 /s
192.168.66.80:9000   server   -               -               -                              threads_running                                                                     46 threads              +0
192.168.66.80:9000   server   -               -               -                              ts_split_compaction_added                                                           15 reqs                +0
192.168.66.80:9000   server   -               -               -                              voluntary_context_switches                                                         413 csws           324.176 /s
192.168.66.80:9000   tablet   a06ff106f2b846d system          transactions                   follower_lag_ms                                                                     97 ms                -722
192.168.66.80:9000   tablet   a06ff106f2b846d system          transactions                   in_progress_ops                                                                      1 ops                 +0
192.168.66.80:9000   tablet   a06ff106f2b846d system          transactions                   log_wal_size                                                                   1048576 bytes               +0
192.168.66.80:9000   tablet   a06ff106f2b846d system          transactions                   raft_term                                                                            9 terms               +0
192.168.66.80:9000   tablet   cf45509727f9601 system          transactions                   follower_lag_ms                                                                    281 ms                -339
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>object_id</th><th>namespace</th><th>object name</th><th>statistic name</th><th>value</th><th>unit</th><th>end value - begin value</th></tr></thead><tbody>
<tr><td>192.168.66.80:9000</td><td>server</td><td>-</td><td>-</td><td>-</td><td>threads_running</td><td>46</td><td>threads</td><td>+0</td></tr>
<tr><td>192.168.66.80:9000</td><td>tablet</td><td>a06ff106f2b846d</td><td>system</td><td>transactions</td><td>log_wal_size</td><td>1048576</td><td>bytes</td><td>+0</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_value.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="countsum-statistics"><a class="header" href="#countsum-statistics">CountSum statistics</a></h1>
<p>In the output genered by ad-hoc or snapshot-diff mode, the second group of statistics shown are 'countsum' statistics. 
These statistics are named in this way, because for the use of <code>yb_stats</code>, the count (total_count) and sum (total_sum) fields are the only usable statistical values. 
The way 'countsum' statistics work is that an event in the code that is tracked by 'countsum' statistics keeps a count for the number of times the event was triggered, and a sum for what it measures. 
In a lot of cases the unit the sum is taking is time (to capture the latency of the event), but can also be bytes (to capture the size of for example an IO), or something else.</p>
<p>The count and sum statistics are counters, for which the value that is used is the difference between the end and begin values.
For the count value difference:</p>
<ul>
<li>If the value is zero during both the begin and end snapshot, the statistic is skipped.</li>
<li>If the value is non-zero and existing in the end snapshot, and the statistic is not existing in the begin snapshot, the end snapshot value is taken as value.</li>
<li>If the value is non-zero and existing in the begin snapshot, and not existing in the end snapshot, the value is skipped.</li>
<li>If the value is non-zero in the begin and end snapshots, but subtracting leads to zero, then the statistic is not printed. Supposedly nothing happened, but previously something happened.</li>
<li>If the value is non-zero in the begin and end snapshots, but the end value is lower than the begin value: this is a suspicious situation. Currently the resulting negative value is shown.</li>
</ul>
<p>This is how countsum statistic output looks like:</p>
<pre><code>192.168.66.80:7000   server   handler_latency_outbound_call_queue_time                                             3                  2.899 /s avg:         0 tot:               0 us
192.168.66.80:7000   server   handler_latency_outbound_call_send_time                                              3                  2.899 /s avg:         0 tot:               0 us
192.168.66.80:7000   server   handler_latency_outbound_call_time_to_response                                       3                  2.899 /s avg:      2666 tot:            8000 us
192.168.66.80:7000   server   handler_latency_yb_master_MasterHeartbeat_TSHeartbeat                                3                  2.899 /s avg:       128 tot:             386 us
192.168.66.80:7000   server   rpc_incoming_queue_time                                                              3                  2.899 /s avg:       146 tot:             439 us
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>statistic name</th><th>count</th><th>count / snapshot time (s)</th><th>sum / count</th><th>sum total</th><th>sum unit</th></tr></thead><tbody>
<tr><td>192.168.66.80:7000</td><td>server</td><td>handler_latency_outbound_call_queue_time</td><td>3</td><td>2.899 /s</td><td>avg:  0</td><td>tot:   0</td><td>us</td></tr>
<tr><td>192.168.66.80:7000</td><td>server</td><td>handler_latency_outbound_call_send_time</td><td>3</td><td>2.899 /s</td><td>avg:  0</td><td>tot:   0</td><td>us</td></tr>
<tr><td>192.168.66.80:7000</td><td>server</td><td>handler_latency_outbound_call_time_to_response</td><td>3</td><td>2.899 /s</td><td>avg:  2666</td><td>tot: 8000</td><td>us</td></tr>
<tr><td>192.168.66.80:7000</td><td>server</td><td>handler_latency_yb_master_MasterHeartbeat_TSHeartbeat</td><td>3</td><td>2.899 /s</td><td>avg:  128</td><td>tot:  386</td><td>us</td></tr>
<tr><td>192.168.66.80:7000</td><td>server</td><td>rpc_incoming_queue_time</td><td>3</td><td>2.899 /s</td><td>avg:  146</td><td>tot:  439</td><td>us</td></tr>
</tbody></table>
</div>
<h1 id="gauges-1"><a class="header" href="#gauges-1">gauges</a></h1>
<p>There is no gauges-like statistic type in 'countsum' statistics.</p>
<h1 id="details-enable"><a class="header" href="#details-enable">details enable</a></h1>
<pre><code>192.168.66.80:9000   server   -               -               -                              rpc_incoming_queue_time                                                            143                 13.877 /s avg:       103 tot:           14807 us
192.168.66.80:9000   server   -               -               -                              transaction_pool_cache                                                               1                  0.097 /s avg:         0 tot:               0 us
192.168.66.80:9000   table    000000000004000 yugabyte        t                              log_append_latency                                                                   4                  0.388 /s avg:        45 tot:             182 us
192.168.66.80:9000   table    000000000004000 yugabyte        t                              log_entry_batches_per_group                                                          3                  0.291 /s avg:         1 tot:               4 requests
192.168.66.80:9000   table    000000000004000 yugabyte        t                              log_group_commit_latency                                                             3                  0.291 /s avg:      2319 tot:            6958 us
192.168.66.80:9000   table    000000000004000 yugabyte        t                              log_sync_latency                                                                     1                  0.097 /s avg:      6706 tot:            6706 us
192.168.66.80:9000   table    000000000004000 yugabyte        t                              rocksdb_bytes_per_write                                                              3                  0.291 /s avg:        12 tot:              36 bytes
192.168.66.80:9000   table    000000000004000 yugabyte        t                              rocksdb_db_write_micros                                                              3                  0.291 /s avg:        11 tot:              34 us
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>object_id</th><th>namespace</th><th>object name</th><th>statistic name</th><th>count</th><th>count snapshot time (s)</th><th>sum / count</th><th>sum total</th><th>sum unit</th></tr></thead><tbody>
<tr><td>192.168.66.80:9000</td><td>server</td><td>-</td><td>-</td><td>-</td><td>rpc_incoming_queue_time</td><td>143</td><td>13.877 /s</td><td>avg:       103</td><td>tot:           14807</td><td>us</td></tr>
<tr><td>192.168.66.80:9000</td><td>server</td><td>-</td><td>-</td><td>-</td><td>transaction_pool_cache</td><td>1</td><td>0.097 /s</td><td>avg:         0</td><td>tot:               0</td><td>us</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>log_append_latency</td><td>4</td><td>0.388 /s</td><td>avg:        45</td><td>tot:             182</td><td>us</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>log_entry_batches_per_group</td><td>3</td><td>0.291 /s</td><td>avg:         1</td><td>tot:               4</td><td>requests</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>log_group_commit_latency</td><td>3</td><td>0.291 /s</td><td>avg:      2319</td><td>tot:            6958</td><td>us</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>log_sync_latency</td><td>1</td><td>0.097 /s</td><td>avg:      6706</td><td>tot:            6706</td><td>us</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>rocksdb_bytes_per_write</td><td>3</td><td>0.291 /s</td><td>avg:        12</td><td>tot:              36</td><td>bytes</td></tr>
<tr><td>192.168.66.80:9000</td><td>table</td><td>000000000004000</td><td>yugabyte</td><td>t</td><td>rocksdb_db_write_micros</td><td>3</td><td>0.291 /s</td><td>avg:        11</td><td>tot:              34</td><td>us</td></tr>
</tbody></table>
</div>
<p>Countsum statistics are called 'course_histograms' in the YugabyteDB sourcecode, and have the fields <code>count</code> and <code>sum</code> in common with 'summaries' in prometheus, however quantile items are not available. YugabyteDB adds the fields min, mean, max, percentile_75, percentile_95, percentile_99, percentile_99_9, and percentile_99_99 to its metrics. These fields are reset when the metrics are read.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_countsum.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="countsumrows-statistics"><a class="header" href="#countsumrows-statistics">CountSumRows statistics</a></h1>
<p>In the output generated by ad-hoc or snapshot-diff mode, a third group that optionally can be shown are the 'countsumrows' statistics. 
These statistics are taken from the YSQL (normally port 13000) http endpoint. 
If no SQL interaction did happen between YSQL/postgres and DocDB, there will be no statistics shown.</p>
<ul>
<li>If a statistic has a zero count in both the begin and end snapshot, it will be skipped.</li>
<li>If a statistic has a non-zero count in both the begin and end snapshot, and subtracting the values leads to zero, it will be skipped.</li>
<li>if a statistic has a lower value in the end snapshot than in the begin snapshot, currently the statistics will be shown, and might get negative.</li>
</ul>
<p>This is how countsumrows statistic output looks like:</p>
<pre><code>192.168.66.80:13000  handler_latency_yb_ysqlserver_SQLProcessor_InsertStmt                                1 avg:          18.552 tot:          18.552 ms, avg:               1 tot:               1 rows
192.168.66.80:13000  handler_latency_yb_ysqlserver_SQLProcessor_SingleShardTransactions                   1 avg:          18.552 tot:          18.552 ms, avg:               1 tot:               1 rows
192.168.66.80:13000  handler_latency_yb_ysqlserver_SQLProcessor_Single_Shard_Transactions                 1 avg:          18.552 tot:          18.552 ms, avg:               1 tot:               1 rows
192.168.66.80:13000  handler_latency_yb_ysqlserver_SQLProcessor_Transactions                              1 avg:          18.552 tot:          18.552 ms, avg:               1 tot:               1 rows
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>statistic name</th><th>count</th><th>sum / count</th><th>sum total</th><th>sum unit</th><th>rows / count</th><th>rows total</th></tr></thead><tbody>
<tr><td>192.168.66.80:13000</td><td>handler_latency_yb_ysqlserver_SQLProcessor_InsertStmt</td><td>1</td><td>avg: 18.552</td><td>tot: 18.552</td><td>ms</td><td>avg:  1</td><td>tot: 1 rows</td></tr>
<tr><td>192.168.66.80:13000</td><td>handler_latency_yb_ysqlserver_SQLProcessor_SingleShardTransactions</td><td>1</td><td>avg: 18.552</td><td>tot: 18.552</td><td>ms</td><td>avg:  1</td><td>tot: 1 rows</td></tr>
<tr><td>192.168.66.80:13000</td><td>handler_latency_yb_ysqlserver_SQLProcessor_Single_Shard_Transactions</td><td>1</td><td>avg: 18.552</td><td>tot: 18.552</td><td>ms</td><td>avg:  1</td><td>tot: 1 rows</td></tr>
<tr><td>192.168.66.80:13000</td><td>handler_latency_yb_ysqlserver_SQLProcessor_Transactions</td><td>1</td><td>avg: 18.552</td><td>tot: 18.552</td><td>ms</td><td>avg:  1</td><td>tot: 1 rows</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_countsumrows.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="statement-statistics"><a class="header" href="#statement-statistics">Statement statistics</a></h1>
<p>In the output generated by ad-hoc or snapshot-diff mode, a fourth group that optionally can be shown are statement statistics.
These statistics are taken from the YSQL (normally port 13000) http endpoint. 
If no SQL interaction did happen between YSQL/postgres and DocDB, then there will be no statements shown.</p>
<p>This is how the statement output looks like:</p>
<pre><code>192.168.66.80:13000          98 avg:           0.002 tot:           0.156 ms avg:          0 tot:          0 rows: begin
192.168.66.80:13000          98 avg:           0.003 tot:           0.305 ms avg:          0 tot:          0 rows: commit
192.168.66.80:13000          98 avg:          78.722 tot:        7714.786 ms avg:       1020 tot:     100000 rows: copy ysql_bench_accounts from stdin
192.168.66.80:13000           1 avg:         456.096 tot:         456.096 ms avg:          0 tot:          0 rows: create table ysql_bench_accounts(aid    int not null,bid int,abalance int,filler
192.168.66.80:13000           1 avg:         451.798 tot:         451.798 ms avg:          0 tot:          0 rows: create table ysql_bench_branches(bid int not null,bbalance int,filler char(88),P
192.168.66.80:13000           1 avg:         483.839 tot:         483.839 ms avg:          0 tot:          0 rows: create table ysql_bench_history(tid int,bid int,aid    int,delta int,mtime times
192.168.66.80:13000           1 avg:         394.892 tot:         394.892 ms avg:          0 tot:          0 rows: create table ysql_bench_tellers(tid int not null,bid int,tbalance int,filler cha
192.168.66.80:13000           1 avg:         569.624 tot:         569.624 ms avg:          0 tot:          0 rows: drop table if exists ysql_bench_accounts, ysql_bench_branches, ysql_bench_histor
192.168.66.80:13000           1 avg:          11.560 tot:          11.560 ms avg:          1 tot:          1 rows: insert into ysql_bench_branches(bid,bbalance) values($1,$2)
192.168.66.80:13000          10 avg:           8.218 tot:          82.179 ms avg:          1 tot:         10 rows: insert into ysql_bench_tellers(tid,bid,tbalance) values ($1,$2,$3)
192.168.66.80:13000           1 avg:        6641.962 tot:        6641.962 ms avg:          0 tot:          0 rows: truncate table ysql_bench_accounts, ysql_bench_branches, ysql_bench_history, ysq
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>calls</th><th>total_time / calls</th><th>total_time</th><th>unit total_time</th><th>rows / calls</th><th>total rows</th><th>query</th></tr></thead><tbody>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:    0.002</td><td>tot:    0.156</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>begin</td></tr>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:    0.003</td><td>tot:    0.305</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>commit</td></tr>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:   78.722</td><td>tot: 7714.786</td><td>ms</td><td>avg: 1020</td><td>tot: 100000 rows</td><td>copy ysql_bench_accounts from stdin</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  456.096</td><td>tot:  456.096</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_accounts(aid    int not null,bid int,abalance int,filler</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  451.798</td><td>tot:  451.798</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_branches(bid int not null,bbalance int,filler char(88),P</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  483.839</td><td>tot:  483.839</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_history(tid int,bid int,aid    int,delta int,mtime times</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  394.892</td><td>tot:  394.892</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_tellers(tid int not null,bid int,tbalance int,filler cha</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  569.624</td><td>tot:  569.624</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>drop table if exists ysql_bench_accounts, ysql_bench_branches, ysql_bench_histor</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:   11.560</td><td>tot:   11.560</td><td>ms</td><td>avg:    1</td><td>tot:      1 rows</td><td>insert into ysql_bench_branches(bid,bbalance) values($1,$2)</td></tr>
<tr><td>192.168.66.80:13000</td><td>10</td><td>avg:    8.218</td><td>tot:   82.179</td><td>ms</td><td>avg:    1</td><td>tot:     10 rows</td><td>insert into ysql_bench_tellers(tid,bid,tbalance) values ($1,$2,$3)</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg: 6641.962</td><td>tot: 6641.962</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>truncate table ysql_bench_accounts, ysql_bench_branches, ysql_bench_history, ysq</td></tr>
</tbody></table>
</div>
<p>For the sake of simplicity, any identical SQL (based on the query text) is summed up, and assumed to be the same statement. This is not correct. (at the time of creation, query_id was not exposed, so this was the only solution)</p>
<p>Please mind the source of the SQL statistics is postgres' pg_stat_statements, and holds a few quirks:</p>
<ul>
<li>Any SQL that returns an error is not saved in 'pg_stat_statements'.</li>
<li>The 'total_time' is actually the time spent in the <em>execution phase</em>. Especially since YSQL might need to perform RPCs to complete its catalog (in rewrite/semantic parse and plan phases), this can miss some time and therefore show less time than a client sees.</li>
<li>A statement's uniqueness in pg_stat_statements is dependent on query_id, dbid and userid. Currently we don't expose all this fields in the http endpoint.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_statement.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="node-exporter-statistics"><a class="header" href="#node-exporter-statistics">Node-exporter statistics</a></h1>
<p>In the output of ad-hoc or snapshot-diff mode, if node-exporter is installed on the YugabyteDB cluster, the last group of statistics that are shown are the node-exporter statistics. 
The captured statistics are essentially a statistic name and a statistic value. 
The values to be displayed are ordered by hostname, metric_type and metric_name.</p>
<p>By default, <code>counter</code> values are shown, for which the value is the difference between the end and begin values.</p>
<ul>
<li>If a counter is zero during both the begin and end snapshot, the statistic is skipped.</li>
<li>If a counter is non-zero and existing in the end snapshot, and the statistic is not existing in the begin snapshot, the end snapshot value is taken as value.</li>
<li>If a counter is non-zero and existing in the begin snapshot, and not existing in the end snapshot, the value is skipped.</li>
<li>If a counter is non-zero in the begin and end snapshots, but subtracting leads to zero, then the statistic is not printed. Supposedly nothing happened, but previously something happened.</li>
<li>If a counter is non-zero in the begin and end snapshots, but the end value is lower than the begin value: this is a suspicious situation. Currently the resulting negative value is shown.</li>
</ul>
<p>This is how node-exporter statistics output looks like:</p>
<pre><code>192.168.66.80:9300   counter  node_context_switches_total                                                       7759.000000         862.111 /s
192.168.66.80:9300   counter  node_cpu_seconds_total_idle                                                          8.150000           0.906 /s
192.168.66.80:9300   counter  node_cpu_seconds_total_irq                                                           0.310000           0.034 /s
192.168.66.80:9300   counter  node_cpu_seconds_total_softirq                                                       0.120000           0.013 /s
192.168.66.80:9300   counter  node_cpu_seconds_total_system                                                        0.170000           0.019 /s
192.168.66.80:9300   counter  node_cpu_seconds_total_user                                                          0.010000           0.001 /s
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>statistic_name</th><th>value</th><th>value / snapshot time (s)</th></tr></thead><tbody>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_context_switches_total</td><td>7759.000000</td><td>862.111 /s</td></tr>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_cpu_seconds_total_idle</td><td>8.150000</td><td>0.906 /s</td></tr>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_cpu_seconds_total_irq</td><td>0.310000</td><td>0.034 /s</td></tr>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_cpu_seconds_total_softirq</td><td>0.120000</td><td>0.013 /s</td></tr>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_cpu_seconds_total_system</td><td>0.170000</td><td>0.019 /s</td></tr>
<tr><td>192.168.66.80:9300</td><td>counter</td><td>node_cpu_seconds_total_user</td><td>0.010000</td><td>0.001 /s</td></tr>
</tbody></table>
</div>
<h1 id="gauges-2"><a class="header" href="#gauges-2">gauges</a></h1>
<p>If the <code>--gauges</code> enable switch is used, gauge type values are shown alongside counter values. </p>
<ul>
<li>If a gauge is zero during both the begin and end snapshot, the statistic is skipped.</li>
<li>If a gauge is non-zero and existing in the end snapshot, and the statistic is not existing in the begin snapshot, the end snapshot value is taken as value.</li>
<li>If a gauge is non-zero and existing in the begin snapshot, and not existing in the end snapshot, the value is skipped.</li>
<li>if a gauge is non-zero in the begin and end snapshots, and subtracting leads to zero, the value is printed(!).</li>
</ul>
<p>This is what this looks like:</p>
<pre><code>192.168.66.80:9300   gauge    node_arp_entries_eth0                                                                2.000000              +0
192.168.66.80:9300   gauge    node_arp_entries_eth1                                                                3.000000              +0
192.168.66.80:9300   gauge    node_boot_time_seconds                                                      1666174770.000000              +0
192.168.66.80:9300   counter  node_context_switches_total                                                        994.000000         994.000 /s
192.168.66.80:9300   gauge    node_cooling_device_max_state_1_intel_powerclamp                                    50.000000              +0
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>metric_type</th><th>statistic name</th><th>end value</th><th>end value - begin value</th></tr></thead><tbody>
<tr><td>192.168.66.80:9300</td><td>gauge</td><td>node_arp_entries_eth0</td><td>2.000000</td><td>+0</td></tr>
<tr><td>192.168.66.80:9300</td><td>gauge</td><td>node_arp_entries_eth1</td><td>3.000000</td><td>+0</td></tr>
<tr><td>192.168.66.80:9300</td><td>gauge</td><td>node_boot_time_seconds</td><td>1666174770.000000</td><td>+0</td></tr>
</tbody></table>
</div><footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_nodeexporter.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="entities-diff"><a class="header" href="#entities-diff">entities diff</a></h1>
<p>Whenever <code>yb_stats</code> is used in ad-hoc diff mode or in snapshot-diff mode, it will read the entity data from the master leader during the begin and the end snapshot.
Entities are objects known to the master which deal with storing and organising the data for YSQL and YCQL.</p>
<p>The end snapshot will verify if the entities found with the begin snapshot, and show any difference it will find.</p>
<p>By default, it will skip the YugabyteDB default system databases/keyspaces:</p>
<ul>
<li>&quot;00000000000000000000000000000001&quot; |   // ycql system</li>
<li>&quot;00000000000000000000000000000002&quot; |   // ycql system_schema</li>
<li>&quot;00000000000000000000000000000003&quot; |   // ycql system_auth</li>
<li>&quot;00000001000030008000000000000000&quot; |   // ysql template1</li>
<li>&quot;000033e5000030008000000000000000&quot;)    // ysql template0</li>
</ul>
<p>When any of the following objects are added or removed, <code>yb_stats</code> will show the change:</p>
<p>Example diff where a YSQL database is created, and a table and an index:</p>
<pre><code>+ Database: ysql.testdb, id: 0000414d000030008000000000000000
+ Object:   ysql.testdb.testtable, state: RUNNING, id: 0000414d00003000800000000000414e
+ Object:   ysql.testdb.testindex, state: RUNNING, id: 0000414d000030008000000000004153
+ Tablet:   ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 state: RUNNING, leader: yb-2.local:9100
+ Tablet:   ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a state: RUNNING, leader: yb-3.local:9100
+ Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-2.local:9100, type: VOTER
+ Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-1.local:9100, type: VOTER
+ Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-3.local:9100, type: VOTER
+ Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-2.local:9100, type: VOTER
+ Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-1.local:9100, type: VOTER
+ Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-3.local:9100, type: VOTER
</code></pre>
<p>And an example where the above YSQL database is dropped:</p>
<pre><code>- Database: ysql.testdb, id: 0000414d000030008000000000000000
- Object:   ysql.testdb.testtable, state: RUNNING, id: 0000414d00003000800000000000414e
- Object:   ysql.testdb.testindex, state: RUNNING, id: 0000414d000030008000000000004153
- Tablet:   ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 state: RUNNING, leader: yb-2.local:9100
- Tablet:   ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a state: RUNNING, leader: yb-3.local:9100
- Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-2.local:9100, type: VOTER
- Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-1.local:9100, type: VOTER
- Replica:  ysql.testdb.testtable.13887764dbe74dfd8303d5785e5821a8 server: yb-3.local:9100, type: VOTER
- Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-2.local:9100, type: VOTER
- Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-1.local:9100, type: VOTER
- Replica:  ysql.testdb.testindex.3320638518854a2b8c0c5bed30a9861a server: yb-3.local:9100, type: VOTER
</code></pre>
<p>Or detect a leader change for a tablet:</p>
<pre><code>* Tablet:   ysql.testdb.testtable.5350a928953c4eb1aaa9eb0581a3112b state: RUNNING leader: yb-3.local:9100-&gt;yb-1.local:9100
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_entities_diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="masters-diff"><a class="header" href="#masters-diff">masters diff</a></h1>
<p>Whenever <code>yb_stats</code> is used in ad-hoc diff mode or in snapshot-diff mode, it will read the master metadata from the master leader during the begin and the end snapshot.</p>
<p>In this way, any changes to the masters, such as a reboot/restart or a role change can be seen.</p>
<p>Example of a leader change because of a restart:</p>
<pre><code>* Master b460d504c6aa488d97bfe266ab506ab6 FOLLOWER-&gt;LEADER Cloud: local, Region: local, Zone: local,
                                          Seqno: 1669798949509360, Start time: 1669798949509360
                                          Http ( yb-3.local:7000 )
                                          Rpc ( yb-3.local:7100 )
* Master d3db2544098b4b808c0c65d4d19f4d3a LEADER-&gt;FOLLOWER Cloud: local, Region: local, Zone: local,
                                          Seqno: 1669798888831913-&gt;1669824380213235, Start time: 1669798888831913-&gt;1669824380213235
                                          Http ( yb-1.local:7000 )
                                          Rpc ( yb-1.local:7100 )
</code></pre>
<p>Here the master <code>d3db2544098b4b808c0c65d4d19f4d3a</code> had it's role changed from LEADER to FOLLOWER.
In the same snapshot, the master <code>b460d504c6aa488d97bfe266ab506ab6</code> had it's role changed from FOLLOWER to LEADER.</p>
<p>The reason for role change from LEADER to FOLLOWER can not be seen, but the start time and the seqno properties also did change.
The change of start time shows the start time was renewed, indicating the master was restarted.
The sequence number is identical to the start time, and therefore changed along with the start time.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_masters_diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="tablet-servers-diff"><a class="header" href="#tablet-servers-diff">tablet servers diff</a></h1>
<p>Whenever <code>yb_stats</code> is used in ad-hoc diff mode or in snapshot-diff mode, it will read the tablet servers metadata from the master leader during the begin and the end snapshot.</p>
<p>In this way, a restart of a tablet server can be detected.</p>
<p>Example of a tablet server restart:</p>
<pre><code>* Tserver: yb-1.local:9000, status: ALIVE, uptime: 1108-&gt;0 (reboot)
</code></pre>
<p>Or when a tablet server is found dead:</p>
<pre><code>* Tserver: yb-1.local:9000, status: ALIVE-&gt;DEAD, uptime: 286-&gt;0 (reboot)
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_tablet_servers_diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="vars-diff"><a class="header" href="#vars-diff">vars diff</a></h1>
<p>Whenever <code>yb_stats</code> is used in ad-hoc diff mode or in snapshot-diff mode, it will read the vars (gflags) using the <code>/api/v1/varz</code> endpoint.
This is executed for both the masters and the tablet servers.
This is done during the begin and end snapshots.</p>
<p>Example of a changed var on all servers between and begin and end snapshot:</p>
<pre><code>* 192.168.66.80:9000   Vars: ysql_enable_packed_row                             false-&gt;true Default-&gt;Custom
* 192.168.66.81:9000   Vars: ysql_enable_packed_row                             false-&gt;true Default-&gt;Custom
* 192.168.66.82:9000   Vars: ysql_enable_packed_row                             false-&gt;true Default-&gt;Custom
</code></pre>
<p>This shows that on the servers 192.168.66.80, 192.168.66.81 and 192.168.66.82 servers on endpoint 9000 (the default tablet server port) a change was detected and reported.</p>
<ul>
<li>The var/gflag is <code>ysql_enabled_packed_row</code>.</li>
<li>The value is changed from <code>false</code> to <code>true</code>.</li>
<li>The change of var changed the type of var from <code>Default</code> (non changed) to <code>Custom</code> (changed).</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_vars_diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="version-diff"><a class="header" href="#version-diff">version diff</a></h1>
<p>Whenever <code>yb_stats</code> is used in ad-hoc diff mode or in snapshot-diff mode, it will read the version using the <code>/api/v1/version</code> endpoint.
This is executed for both the masters and the tablet servers.
This is done during the begin and end snapshots.</p>
<p>Example of changed versions on all servers between and begin and end snapshot:</p>
<pre><code>* ip-172-158-59-19:7000 Versions: 2.17.1.0 184-&gt;201 RELEASE 09 Nov 2022 22:48:49 UTC-&gt;14 Nov 2022 13:07:31 UTC 971d32f9bf50d11c067bda4b5498d27611583c2c-&gt;d9d98761806ef4f37f501e2eb40bb7dcd981bb65
* ip-172-158-59-19:9000 Versions: 2.17.1.0 184-&gt;201 RELEASE 09 Nov 2022 22:48:49 UTC-&gt;14 Nov 2022 13:07:31 UTC 971d32f9bf50d11c067bda4b5498d27611583c2c-&gt;d9d98761806ef4f37f501e2eb40bb7dcd981bb65
</code></pre>
<p>This shows that on the servers <code>ip-172-158-59-19:7000</code> and <code>ip-172-158-59-19:9000</code> there have been version changes.</p>
<ul>
<li>The version stayed the same.</li>
<li>The build number changed from <code>184</code> to <code>201</code>.</li>
<li>The build date changed from <code>09 Nov 2022 22:48:49 UTC</code> to <code>14 Nov 2022 13:07:31 UTC</code>.</li>
<li>The build git hash changed from <code>971d32f9bf50d11c067bda4b5498d27611583c2c</code> to <code>d9d98761806ef4f37f501e2eb40bb7dcd981bb65</code>.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_version_diff.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-modes"><a class="header" href="#print-modes">Print modes</a></h1>
<p>Outside of performance metrics, a snapshot contains a lot more information. 
Most of the additonal information can be obtained using print commands. 
All of the print commands take a single snapshot number, some print commands do accept no snapshot number, which makes <code>yb_stats</code> perform a live lookup.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-version"><a class="header" href="#print-version">print-version</a></h1>
<p>Print version information from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-version &lt;snapshot number&gt;</code>: print version information from stored snapshot.</li>
<li><code>--print-version</code>: print version information from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-version
hostname_port        version_number  build_nr   build_type build_timestamp          git_hash
192.168.66.82:9000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
192.168.66.82:7000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
192.168.66.81:9000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
192.168.66.81:7000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
192.168.66.80:9000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
192.168.66.80:7000   2.15.3.2        1          RELEASE    04 Nov 2022 16:53:01 UTC 5ef608b43a994ab03a12ed3359258ec156d04a14
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_version.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-log"><a class="header" href="#print-log">print-log</a></h1>
<p>Print log information from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-log &lt;snapshot number&gt;</code>: print log information from a stored snapshot.</li>
<li><code>--print-log</code>: print log information from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--log-severity</code> filters log lines by the letter that indicates the severity. Default: WEF, optional: I.</li>
<li><code>--stat-name-match</code>: filters log lines by the sourcefile name and line number (such as &quot;leader_election.cc:216&quot;) or message fields via a regular expression.</li>
</ul>
<p>Explanation of the severity letters (increasing in severity):</p>
<ul>
<li>I: Informal </li>
<li>W: Warning </li>
<li>E: Error</li>
<li>F: Fatal</li>
</ul>
<p>The <code>--print-log</code> option prints the log lines based on the timestamp found in the log line. 
The log lines are taken from the different servers, and ordered on time, which is the local timestamp, so you have to be aware of clock skew.
The timestamps in the logs are UTC time, so timezone settings should not require recalculation of the timestamp.</p>
<p>Example:</p>
<pre><code>% yb_stats --print-log --log-severity IWEF --hostname-match '(7000|9000)
...
192.168.66.80:9000   2023-01-29 12:29:45.447729 UTC I raft_consensus.cc:3356 T 5652a6b7a4ea47d198f0142895addf09 P 414ad0910477464fb4c17dfbd912de10 [term 1 FOLLOWER]: Calling mark dirty synchronously for reason code FOLLOWER_NO_OP_COMPLETE
192.168.66.81:9000   2023-01-29 12:29:45.448503 UTC I raft_consensus.cc:3356 T 5652a6b7a4ea47d198f0142895addf09 P 8e317433953244dfbff8dea89bdd7d77 [term 1 FOLLOWER]: Calling mark dirty synchronously for reason code FOLLOWER_NO_OP_COMPLETE
192.168.66.82:7000   2023-01-29 12:29:45.448714 UTC I catalog_manager.cc:7115 Peer 8e317433953244dfbff8dea89bdd7d77 sent incremental report for 5652a6b7a4ea47d198f0142895addf09, prev state op id: -1, prev state term: 1, prev state has_leader_uuid: 1. Consensus state: current_term: 1 leader_uuid: &quot;0f41bb1e8bc34afe801d422c3c3064b4&quot; config { opid_index: -1 peers { permanent_uuid: &quot;0f41bb1e8bc34afe801d422c3c3064b4&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-3.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local3&quot; } } peers { permanent_uuid: &quot;414ad0910477464fb4c17dfbd912de10&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-1.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local1&quot; } } peers { permanent_uuid: &quot;8e317433953244dfbff8dea89bdd7d77&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-2.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local2&quot; } } }
192.168.66.82:7000   2023-01-29 12:29:45.449941 UTC I catalog_manager.cc:7115 Peer 414ad0910477464fb4c17dfbd912de10 sent incremental report for 5652a6b7a4ea47d198f0142895addf09, prev state op id: -1, prev state term: 1, prev state has_leader_uuid: 1. Consensus state: current_term: 1 leader_uuid: &quot;0f41bb1e8bc34afe801d422c3c3064b4&quot; config { opid_index: -1 peers { permanent_uuid: &quot;0f41bb1e8bc34afe801d422c3c3064b4&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-3.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local3&quot; } } peers { permanent_uuid: &quot;414ad0910477464fb4c17dfbd912de10&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-1.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local1&quot; } } peers { permanent_uuid: &quot;8e317433953244dfbff8dea89bdd7d77&quot; member_type: VOTER last_known_private_addr { host: &quot;yb-2.local&quot; port: 9100 } cloud_info { placement_cloud: &quot;local&quot; placement_region: &quot;local&quot; placement_zone: &quot;local2&quot; } } }
192.168.66.82:7000   2023-01-29 12:29:45.457672 UTC I ysql_transaction_ddl.cc:55 Verifying Transaction { transaction_id: c57ef1a4-8917-437d-8fc6-a00328d6fc95 isolation: SNAPSHOT_ISOLATION status_tablet: ecc3d88a304f4a82894229c65831bb9f priority: 15800696521729142229 start_time: { physical: 1674995385026221 } locality: GLOBAL old_status_tablet: }
192.168.66.82:7000   2023-01-29 12:29:45.459448 UTC I ysql_transaction_ddl.cc:110 Got Response for { transaction_id: c57ef1a4-8917-437d-8fc6-a00328d6fc95 isolation: SNAPSHOT_ISOLATION status_tablet: ecc3d88a304f4a82894229c65831bb9f priority: 15800696521729142229 start_time: { physical: 1674995385026221 } locality: GLOBAL old_status_tablet: }, resp: status: PENDING status_hybrid_time: 6860781098837565439 propagated_hybrid_time: 6860781098837594112 aborted_subtxn_set { }
192.168.66.80:9000   2023-01-29 12:29:45.480443 UTC I table_creator.cc:363 Created table yugabyte.t of type PGSQL_TABLE_TYPE
192.168.66.82:7000   2023-01-29 12:29:45.668880 UTC I catalog_manager.cc:4098 T 00000000000000000000000000000000 P 52d4dda57d5740459c014a1a9dc07eae: Table transaction succeeded: t [id=000033e8000030008000000000004000]
</code></pre>
<p>These are some informal messages which are produced when a table is created, and show some of the internal dealing with RAFT, and the master (indicated by port 7000, and the network address implicitly shows the master leader), managing the table and therefore tablet creation.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_log.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="tail-log"><a class="header" href="#tail-log">tail-log</a></h1>
<p>Print new log entries from a live cluster, in the same way that <code>tail -f</code> works on a file.</p>
<ul>
<li><code>--tail-log</code>: print log information from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--log-severity</code> filters log lines by the letter that indicates the severity. Default: WEF, optional: I.</li>
<li><code>--stat-name-match</code>: filters log lines by the sourcefile name and line number (such as &quot;log.cc:1516&quot;) or message fields via a regular expression.</li>
</ul>
<p>Explanation of the severity letters (increasing in severity):</p>
<ul>
<li>I: Informal</li>
<li>W: Warning</li>
<li>E: Error</li>
<li>F: Fatal</li>
</ul>
<p>The <code>--tail-log</code> option prints the log lines based on the timestamp found in the log line.
The log lines are taken from the different servers, and ordered on time, which is the local timestamp, so you have to be aware of clock skew.
The timestamps in the logs are UTC time, so timezone settings should not require recalculation of the timestamp.</p>
<p>Example:</p>
<pre><code>% yb_stats --tail-log --log-severity IWEF --hostname-match 9000 --stat-name-match '(leader_election|Granting vote|Granting yes vote)'
192.168.66.80:9000   2022-12-19 14:37:16.188669 +01:00 I leader_election.cc:216 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 pre-election: Requesting vote from peer 64dc6522080c433c9cbd2c83efccb025
192.168.66.80:9000   2022-12-19 14:37:16.188694 +01:00 I leader_election.cc:216 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 pre-election: Requesting vote from peer 9e982449051e43f3902a4fb24d639b84
192.168.66.82:9000   2022-12-19 14:37:16.188913 +01:00 I raft_consensus.cc:2375 T 411a6843451a4e87aeca805085a228ba P 64dc6522080c433c9cbd2c83efccb025 [term 0 FOLLOWER]: Pre-election. Granting vote for candidate 3152ba00f652431baeeafa1b36336093 in term 1
192.168.66.81:9000   2022-12-19 14:37:16.191915 +01:00 I raft_consensus.cc:2375 T 411a6843451a4e87aeca805085a228ba P 9e982449051e43f3902a4fb24d639b84 [term 0 FOLLOWER]: Pre-election. Granting vote for candidate 3152ba00f652431baeeafa1b36336093 in term 1
192.168.66.80:9000   2022-12-19 14:37:16.192420 +01:00 I leader_election.cc:367 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 pre-election: Vote granted by peer 64dc6522080c433c9cbd2c83efccb025
192.168.66.80:9000   2022-12-19 14:37:16.192452 +01:00 I leader_election.cc:242 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 pre-election: Election decided. Result: candidate won.
192.168.66.80:9000   2022-12-19 14:37:16.202473 +01:00 I leader_election.cc:216 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 election: Requesting vote from peer 64dc6522080c433c9cbd2c83efccb025
192.168.66.80:9000   2022-12-19 14:37:16.202504 +01:00 I leader_election.cc:216 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 election: Requesting vote from peer 9e982449051e43f3902a4fb24d639b84
192.168.66.82:9000   2022-12-19 14:37:16.210361 +01:00 I raft_consensus.cc:3022 T 411a6843451a4e87aeca805085a228ba P 64dc6522080c433c9cbd2c83efccb025 [term 1 FOLLOWER]:  Leader election vote request: Granting yes vote for candidate 3152ba00f652431baeeafa1b36336093 in term 1.
192.168.66.80:9000   2022-12-19 14:37:16.211731 +01:00 I leader_election.cc:367 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 election: Vote granted by peer 9e982449051e43f3902a4fb24d639b84
192.168.66.80:9000   2022-12-19 14:37:16.211760 +01:00 I leader_election.cc:242 T 411a6843451a4e87aeca805085a228ba P 3152ba00f652431baeeafa1b36336093 [CANDIDATE]: Term 1 election: Election decided. Result: candidate won.
192.168.66.81:9000   2022-12-19 14:37:16.211910 +01:00 I raft_consensus.cc:3022 T 411a6843451a4e87aeca805085a228ba P 9e982449051e43f3902a4fb24d639b84 [term 1 FOLLOWER]:  Leader election vote request: Granting yes vote for candidate 3152ba00f652431baeeafa1b36336093 in term 1.
</code></pre>
<p>The <code>--tail-log</code> command has the additional switches <code>--log-severity</code> set to include 'I' severity loglines, 
has <code>--hostname-match</code> set to '9000' in order to only allow tablet server loglines, 
and has <code>--stat-name-match</code> in order to allow only the regex '(leader_election|Granting vote|Granting yes vote)' 
for sourcefile name and number and message.</p>
<p>Press interrupt (ctrl-c) to terminate tailing the logs.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/tail_mode_log.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-entities"><a class="header" href="#print-entities">print-entities</a></h1>
<p>Print entities (database, database object, tablet, replica) from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-entities &lt;snapshot number&gt;</code>: print entities from a stored snapshot.</li>
<li><code>--print-entities</code>: print entities from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--table-name-match</code>: filter by object name regular expression.</li>
<li><code>--details-enable</code>: print the entity information from all masters.</li>
</ul>
<p>The entity information is available on the masters, on the leader and the followers.
In order to get the current information, <code>yb_stats</code> fetches information to learn the master leader first, and then obtains the entity information from the master leader, unless the <code>--details-enable</code> switch is set.</p>
<p>For YSQL objects/entities, <code>yb_stats</code> takes the OID from the object id and filters out OIDs lower than 16384, because these are system OIDs.</p>
<p>Example:</p>
<pre><code>% yb_stats --print-entities
Object:   ysql.yugabyte.t, state: RUNNING, id: 000033e8000030008000000000004000
Tablet:   ysql.yugabyte.t.7f4fc16eba28432e8ed2baf4603f9590 state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.t.ce1302dada834f619e67dffc847a80fe state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.t.f035128dd43d43d3a1a9d4c44727df99 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.yugabyte.tt, state: RUNNING, id: 000033e8000030008000000000004100
Tablet:   ysql.yugabyte.tt.3ae53662d5374897b8a55899f7ceb9c4 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.tt.880a7b69ae4a474b96d3ff0b7117867b state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.tt.e844bce904794c9799301a2a95cdbe82 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.yugabyte.ysql_bench_history, state: RUNNING, id: 000033e800003000800000000000413b
Tablet:   ysql.yugabyte.ysql_bench_history.11476b9ff3bd4cdeb89a6b188de44b51 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_history.1f01c2e8a9ba467b8495b304649bcbde state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_history.fd9094233dc04e9fa17084b99c42fea6 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.yugabyte.ysql_bench_tellers, state: RUNNING, id: 000033e800003000800000000000413e
Tablet:   ysql.yugabyte.ysql_bench_tellers.918cba44a4d34b699aab6a53eb2399bf state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_tellers.a0a6a3f68cfd4ce697f9c412b74cf84d state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_tellers.d2b6e484972c4443868e1887d05bc7a4 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.yugabyte.ysql_bench_accounts, state: RUNNING, id: 000033e8000030008000000000004143
Tablet:   ysql.yugabyte.ysql_bench_accounts.43e33bb5a7a34a4c8b631d08f4544165 state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_accounts.634d9612c86e4a98a9ffdba70a76227f state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_accounts.da848f4a61ea43c7a7d903b1c28b6942 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.yugabyte.ysql_bench_branches, state: RUNNING, id: 000033e8000030008000000000004148
Tablet:   ysql.yugabyte.ysql_bench_branches.b243250ea9f145ccbb68119be37f540d state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_branches.b948c3f199954959b295c78d6f3f99c7 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER )
Tablet:   ysql.yugabyte.ysql_bench_branches.d456575fb4a04b9ea9e438b93129aa2f state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
Object:   ysql.testdb.testtable, state: RUNNING, id: 00004154000030008000000000004155
Tablet:   ysql.testdb.testtable.5350a928953c4eb1aaa9eb0581a3112b state: RUNNING
            ( VOTER,yb-2.local:9100,LEADER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER )
Object:   ysql.testdb.testindex, state: RUNNING, id: 0000415400003000800000000000415a
Tablet:   ysql.testdb.testindex.16c89cf34d054f0fb9116534d366ec33 state: RUNNING
            ( VOTER,yb-2.local:9100,FOLLOWER VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER )
</code></pre>
<p>Using the <code>/dump-entities</code> endpoint it's not possible to make a distinction between the object types of table, index or materialized view.</p>
<ul>
<li>For every object, a full name is shown in the form of <code>[database type].[database/keyspace].[object name]</code>, the state and the id of the object.</li>
<li>An object contains one or more tablets. </li>
<li>For every tablet: a full name is shown in the form of <code>[database type].[database/keyspace].[object name].[tablet id]</code>. </li>
<li>A tablet has no name, only an id.</li>
<li>For every tablet there is also the replica information in between brackets. For every replica, the type, RPC hostname and port and follower or leader designation.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_entities.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-masters"><a class="header" href="#print-masters">print-masters</a></h1>
<p>Print the current masters from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-masters &lt;snapshot number&gt;</code>: print masters from a stored snapshot.</li>
<li><code>--print-masters</code>: print masters from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--details-enable</code>: print the master information from all masters.</li>
</ul>
<p>In order to get the current information, <code>yb_stats</code> fetches information to learn the master leader first, and then obtains the entity information from the master leader, unless the <code>--details-enable</code> switch is set.</p>
<p>Example:</p>
<pre><code>% yb_stats --print-masters
d3db2544098b4b808c0c65d4d19f4d3a LEADER   Cloud: local, Region: local, Zone: local
                                 Seqno: 1669886426374545 Start time: 1669886426374545
                                 RPC addresses: ( yb-1.local:7100  )
                                 HTTP addresses: ( yb-1.local:7000  )
5334e8170e74496c9780d64e09177010 FOLLOWER Cloud: local, Region: local, Zone: local
                                 Seqno: 1669886456237856 Start time: 1669886456237856
                                 RPC addresses: ( yb-2.local:7100  )
                                 HTTP addresses: ( yb-2.local:7000  )
b460d504c6aa488d97bfe266ab506ab6 FOLLOWER Cloud: local, Region: local, Zone: local
                                 Seqno: 1669886489682609 Start time: 1669886489682609
                                 RPC addresses: ( yb-3.local:7100  )
                                 HTTP addresses: ( yb-3.local:7000  )
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_masters.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-tablet-servers"><a class="header" href="#print-tablet-servers">print-tablet-servers</a></h1>
<p>Print the current tablet servers from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-tablet-servers &lt;snapshot number&gt;</code>: print tablet servers from a stored snapshot.</li>
<li><code>--print-tablet-servers</code>: print tablet servers from a live cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--details-enable</code>: print the tablet servers information from all masters.</li>
</ul>
<p>In order to get the current information, <code>yb_stats</code> fetches to learn the master leader first, and then obtain the tablet servers information from the master leader, unless the <code>--details-enable</code> switch is set.</p>
<p>Example:</p>
<pre><code>yb-2.local:9000      ALIVE Cloud: local, Region: local, Zone: local2
                     HB time: 2.1s, Uptime: 0, Ram 8.39 MB
                     SST files: nr: 0, size: 0 B, uncompressed: 0 B
                     ops read: 0, write: 0
                     tablets: active: 14, user (leader/total): 7/20, system (leader/total): 0/12
                     Path: /mnt/d0, total: 10724835328, used: 992555008 (9.25%)
yb-1.local:9000      ALIVE Cloud: local, Region: local, Zone: local1
                     HB time: 0.0s, Uptime: 0, Ram 9.44 MB
                     SST files: nr: 0, size: 0 B, uncompressed: 0 B
                     ops read: 0, write: 0
                     tablets: active: 16, user (leader/total): 6/20, system (leader/total): 0/12
                     Path: /mnt/d0, total: 10724835328, used: 441438208 (4.12%)
yb-3.local:9000      ALIVE Cloud: local, Region: local, Zone: local3
                     HB time: 0.1s, Uptime: 1118, Ram 62.46 MB
                     SST files: nr: 13, size: 4.46 MB, uncompressed: 15.24 MB
                     ops read: 0, write: 0
                     tablets: active: 32, user (leader/total): 6/20, system (leader/total): 5/12
                     Path: /mnt/d0, total: 10724835328, used: 922292224 (8.60%)
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_tablet_servers.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-vars"><a class="header" href="#print-vars">print-vars</a></h1>
<p>Print the current vars (gflags) from a live cluster or from a snapshot.</p>
<ul>
<li><code>--print-vars &lt;snapshot number&gt;</code>: print variables/gflags from every server (endpoint) in a stored snapshot.</li>
<li><code>--print-vars</code>: print variables/gflags from every server (endpoint) in the cluster.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--details-enable</code>: print variables with 'Default' type too.</li>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--stat-name-filter</code>: filter by variable name regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-vars --hostname-match 192.168.66.82:9000
192.168.66.82:9000   log_filename                                       yb-tserver                               NodeInfo
192.168.66.82:9000   placement_cloud                                    local                                    NodeInfo
192.168.66.82:9000   placement_region                                   local                                    NodeInfo
192.168.66.82:9000   placement_zone                                     local3                                   NodeInfo
192.168.66.82:9000   rpc_bind_addresses                                 0.0.0.0                                  NodeInfo
192.168.66.82:9000   webserver_interface                                                                         NodeInfo
192.168.66.82:9000   webserver_port                                     9000                                     NodeInfo
192.168.66.82:9000   client_read_write_timeout_ms                       600000                                   Custom
192.168.66.82:9000   cql_proxy_bind_address                             0.0.0.0:9042                             Custom
192.168.66.82:9000   db_block_cache_size_percentage                     10                                       Custom
192.168.66.82:9000   default_memory_limit_to_ram_ratio                  0.59999999999999998                      Custom
192.168.66.82:9000   flagfile                                           /opt/yugabyte/conf/tserver.conf          Custom
192.168.66.82:9000   fs_data_dirs                                       /mnt/d0                                  Custom
192.168.66.82:9000   global_log_cache_size_limit_mb                     32                                       Custom
192.168.66.82:9000   leader_lease_duration_ms                           4000                                     Custom
192.168.66.82:9000   log_cache_size_limit_mb                            16                                       Custom
192.168.66.82:9000   mem_tracker_tcmalloc_gc_release_bytes              5062950                                  Custom
192.168.66.82:9000   pg_yb_session_timeout_ms                           600000                                   Custom
192.168.66.82:9000   pgsql_proxy_bind_address                           0.0.0.0:5433                             Custom
192.168.66.82:9000   raft_heartbeat_interval_ms                         1000                                     Custom
192.168.66.82:9000   redis_proxy_bind_address                           0.0.0.0:6379                             Custom
192.168.66.82:9000   server_tcmalloc_max_total_thread_cache_bytes       33554432                                 Custom
192.168.66.82:9000   start_pgsql_proxy                                  true                                     Custom
192.168.66.82:9000   tserver_master_addrs                               yb-1.local:7100,yb-2.local:7100,yb-3.local:7100 Custom
192.168.66.82:9000   yb_num_shards_per_tserver                          2                                        Custom
192.168.66.82:9000   ysql_num_shards_per_tserver                        1                                        Custom
192.168.66.82:9000   regular_tablets_data_block_key_value_encoding      three_shared_parts                       Auto
192.168.66.82:9000   TEST_auto_flags_initialized                        true                                     Auto
</code></pre>
<p>This is using the new <code>/api/v1/varz</code> endpoint. For older versions, use <code>--print-gflags</code>.</p>
<p>The new variables/gflags page shows a classification or 'type' per variable/gflag.</p>
<ul>
<li>Default</li>
<li>NodeInfo</li>
<li>Custom</li>
<li>Auto</li>
</ul>
<p>Variables of the type <code>Auto</code> are not changed, and therefore are not shown by default.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_vars.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-memtrackers"><a class="header" href="#print-memtrackers">print-memtrackers</a></h1>
<p>Print the memtracker page from a snapshot.</p>
<p><code>--print-memtrackers &lt;snapshot number&gt;</code>: print memtrackers information from a stored snapshot.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--stat-name-match</code>: filter by memory area name (id) regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-memtrackers 2 --hostname-match 82:700 --stat-name-match '(root|TCMalloc|server)'
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:7000, Snapshot number: 2, Snapshot time: 2022-10-18 15:26:20.125948 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
hostname_port        id                                                  current_consumption     peak_consumption                limit
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.82:7000   root                                                             26.86M               28.09M              241.44M
192.168.66.82:7000   TCMalloc Central Cache                                           812.7K               961.9K                 none
192.168.66.82:7000   TCMalloc PageHeap Free                                            2.26M                4.73M                 none
192.168.66.82:7000   TCMalloc Thread Cache                                            716.9K                1.97M                 none
192.168.66.82:7000   TCMalloc Transfer Cache                                          985.5K                1.41M                 none
192.168.66.82:7000   server                                                  197.5K (12.62M)               232.1K                 none
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_memtrackers.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-rpcs"><a class="header" href="#print-rpcs">print-rpcs</a></h1>
<p>Print RPC (remote procedure call) information from a snapshot.</p>
<ul>
<li><code>--print-rpcs &lt;snapshot number&gt;</code>: print rpc information from a stored snapshot.</li>
</ul>
<p>By default, <code>--print-rpcs</code> prints out a summary (a count of RPCs) per host and port. Use <code>--details-enable</code> to see all individual RPCs.
<code>--print-rpcs</code> includes port 13000 (YSQL), which means the YSQL connections.</p>
<p>Additional flags:</p>
<ul>
<li><code>--details-enable</code>: print all individual RPC connections, instead of a summary.</li>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-rpcs 2
----------------------------------------------------------------------------------------------------
Host: 192.168.66.80; port: 13000, count: 2; port: 7000, count: 20; port: 9000, count: 49
----------------------------------------------------------------------------------------------------
Host: 192.168.66.81; port: 13000, count: 1; port: 7000, count: 19; port: 9000, count: 41
----------------------------------------------------------------------------------------------------
Host: 192.168.66.82; port: 13000, count: 1; port: 7000, count: 57; port: 9000, count: 40
----------------------------------------------------------------------------------------------------
</code></pre>
<p>With <code>--details-enable</code> and <code>--hostname-match</code> it's posssible to see the current connections to YSQL for a node, for example:</p>
<pre><code>% yb_stats --print-rpcs 27 --details-enable --hostname-match 80:13000

----------------------------------------------------------------------------------------------------
Host: 192.168.66.80; port: 13000, count: 2
----------------------------------------------------------------------------------------------------
192.168.66.80:13000 idle yugabyte client backend ysqlsh 127.0.0.1
192.168.66.80:13000   checkpointer
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_rpcs.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-threads"><a class="header" href="#print-threads">print-threads</a></h1>
<p>Print current threads from a snapshot.</p>
<ul>
<li><code>--print-threads &lt;snapshot number&gt;</code>: print current threads from a snapshot.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-threads 27 --hostname-match 80:9000
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.80:9000, Snapshot number: 27, Snapshot time: 2022-12-01 11:24:08.436165 +01:00
--------------------------------------------------------------------------------------------------------------------------------------
hostname_port        thread_name                          cum_user_cpu_s     cum_kernel_cpu_s     cum_iowait_cpu_s stack
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.80:9000   pg_supervisorxx-7789                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::pgwrapper::PgSupervisor::RunThread();yb::Subprocess::DoWait();__GI___waitpid
192.168.66.80:9000   CQLServer_reactor-7801                       0.070s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Reactor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   RedisServer_reactor-7794                     0.280s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Reactor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   TabletServer_reactor-7732                    0.070s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Reactor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   acceptorxxxxxxx-7803                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Acceptor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   acceptorxxxxxxx-7796                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Acceptor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   acceptorxxxxxxx-7739                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::Acceptor::RunThread();ev_run;epoll_poll;__GI_epoll_wait
192.168.66.80:9000   heartbeatxxxxxx-7743                         0.190s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::tserver::Heartbeater::Thread::RunThread();__pthread_cond_timedwait
192.168.66.80:9000   iotp_CQLServer_3-7800                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_CQLServer_2-7799                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_CQLServer_1-7798                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_CQLServer_0-7797                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();boost::asio::detail::epoll_reactor::run();__GI_epoll_wait
192.168.66.80:9000   iotp_RedisServer_1-7791                      0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_RedisServer_2-7792                      0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_RedisServer_3-7793                      0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_RedisServer_0-7790                      0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();boost::asio::detail::epoll_reactor::run();__GI_epoll_wait
192.168.66.80:9000   iotp_TabletServer_0-7728                     0.150s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_TabletServer_2-7730                     0.320s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_TabletServer_3-7731                     0.310s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();__pthread_cond_wait
192.168.66.80:9000   iotp_TabletServer_1-7729                     0.210s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();boost::asio::detail::epoll_reactor::run();__GI_epoll_wait
192.168.66.80:9000   iotp_call_home_0-7748                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::rpc::IoThreadPool::Impl::Execute();boost::asio::detail::scheduler::run();boost::asio::detail::epoll_reactor::run();__GI_epoll_wait
192.168.66.80:9000   maintenance_scheduler-7745                   0.330s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::MaintenanceManager::RunSchedulerThread();__pthread_cond_timedwait
192.168.66.80:9000   rb-session-expx-7736                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::tserver::RemoteBootstrapServiceImpl::EndExpiredSessions();yb::CountDownLatch::WaitFor();yb::ConditionVariable::WaitUntil();__pthread_cond_timedwait
192.168.66.80:9000   rpc_tp_TabletServer-high-pri_4-7782               0.230s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer-high-pri_3-7774               0.170s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer-high-pri_2-7773               0.250s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer-high-pri_1-7768               0.210s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer-high-pri_0-7767               0.170s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_11-7761                  0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_10-7760                  0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_9-7759                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_8-7758                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_7-7757                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_6-7756                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_5-7755                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_4-7754                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_3-7753                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_2-7747                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_1-7746                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   rpc_tp_TabletServer_0-7741                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();__pthread_cond_wait
192.168.66.80:9000   flush scheduler bgtask-7733                  0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::BackgroundTask::Run();__pthread_cond_wait
192.168.66.80:9000   server_clientcb [worker]-7744                0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   cdc_clientcb [worker]-7737                   0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   MaintenanceMgr [worker]-7129                 0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   log-alloc [worker]-7128                      0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   append [worker]-7127                         0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   prepare [worker]-7126                        0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   log-sync [worker]-7125                       0.000s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
192.168.66.80:9000   consensus [worker]-7124                      0.830s               0.000s               0.000s __clone;start_thread;yb::Thread::SuperviseThread();yb::ThreadPool::DispatchThread();__pthread_cond_wait
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_threads.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="print-gflags"><a class="header" href="#print-gflags">print-gflags</a></h1>
<p>Print gflags information from a snapshot.</p>
<ul>
<li><code>--print-gflags &lt;snapshot number&gt;</code>: print gflags from a stored snapshot.</li>
</ul>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code>: filter by hostname or port regular expression.</li>
<li><code>--stat-name-match</code> filter by gflag name regular expression.</li>
</ul>
<p>Example:</p>
<pre><code>% yb_stats --print-gflags 2 --hostname-match 82:700 --stat-name-match wal
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:7000, Snapshot number: 2, Snapshot time: 2022-10-18 15:26:20.128980 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
cdc_wal_retention_time_secs                                                      14400
time_based_wal_gc_clock_delta_usec                                               0
bytes_durable_wal_write_mb                                                       1
durable_wal_write                                                                true
interval_durable_wal_write_ms                                                    1000
require_durable_wal_write                                                        false
save_index_into_wal_segments                                                     false
fs_wal_dirs                                                                      /mnt/d0
skip_wal_rewrite                                                                 true
TEST_download_partial_wal_segments                                               false
TEST_pause_rbs_before_download_wal                                               false
TEST_fault_crash_after_wal_deleted                                               0
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/print_mode_gflags.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="crontab"><a class="header" href="#crontab">Crontab</a></h1>
<p>In lots of cases it might be really convenient to have historical snapshots, so you can &quot;look back in time&quot;. This can be done by scheduling running <code>yb_stats</code> via the crontab.</p>
<ol>
<li>
<p>Install yb_stats using the RPM.
See <a href="./install.html">install</a></p>
</li>
<li>
<p>Create a directory on a filesystem with enough diskspace</p>
</li>
</ol>
<pre><code>mkdir /home/yugabyte/yb_stats-history
</code></pre>
<p>In this example a directory in the home directory of the yugabyte user is used.
It is hard to specify 'enough' for the above statement of 'with enough diskspace'. It depends on the size of the cluster.
In general it's best to run <code>yb_stats</code> in a separate directory, so that it can use it's own <code>.env</code> file.</p>
<ol start="3">
<li>Setup run configuration with <code>.env</code></li>
</ol>
<pre><code>cd /home/yugabyte/yb_stats-history
yb_stats --hosts 10.1.2.0,10.1.2.1,10.1.2.3 --parallel 3
</code></pre>
<p>This will trigger ad-hoc mode, press enter and validate if it fetched the correct hosts and endpoints.
Be conservative with parallellism. See <a href="./specifying_parallel.html">parallel</a></p>
<ol start="4">
<li>Schedule <code>yb_stats</code> in crontab</li>
</ol>
<pre><code>crontab -e
5 */1 * * * yb_stats_path=&quot;/home/yugabyte/yb_stats-history&quot; &amp;&amp; (date &amp;&amp; cd $yb_stats_path &amp;&amp; /usr/local/bin/yb_stats --snapshot) &gt;&gt; $yb_stats_path/yb_stats_run.out 2&gt;&amp;1
</code></pre>
<p>-----experimental</p>
<ol start="5">
<li>Let logrotate cleanup old yb-stats snapshots:</li>
</ol>
<pre><code class="language-shell">vi /etc/logrotate.d/yb_stats
</code></pre>
<p>File contents:</p>
<pre><code>/home/yugabyte/yb_stats-history/yb_stats.snapshots {
	daily
	rotate 7
	missingok
}
</code></pre>
<p>Mind the place from where logrotate scans the files (<code>/home/yugabyte/yb_stats-history/yb_stats.snapshots</code>), and the cleaning schedule: <code>daily</code> logrotate will allow files that are not touched for 7 times: so files are kept for a week.</p>
<p>This currently will leave the removed snapshots in the snapshot.index file.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/crontab.md">Edit this page on GitHub.</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<p><code>yb_stats</code> by default prints as little as it can to the screen, and will therefore NOT show issues that it can overcome. </p>
<p>In order to let <code>yb_stats</code> provide more information about what it encountering, you can increase the logging level. The default logging level is <code>error</code>, which will also terminate execution. This is how that is done:</p>
<p>Logging level warning: <code>warn</code>:</p>
<pre><code class="language-shell">RUST_LOG=warn yb_stats
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.82:12000, type: server, namespace: -, table_name: -: RejectedU64MetricValue {
        name: &quot;threads_running_thread_pool&quot;,
        value: 18446744073709551614,
    }
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.82:7000, type: cluster, namespace: -, table_name: -: RejectedBooleanMetricValue {
        name: &quot;is_load_balancing_enabled&quot;,
        value: false,
    }
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.81:12000, type: server, namespace: -, table_name: -: RejectedU64MetricValue {
        name: &quot;threads_running_thread_pool&quot;,
        value: 18446744073709551614,
    }
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.81:7000, type: cluster, namespace: -, table_name: -: RejectedBooleanMetricValue {
        name: &quot;is_load_balancing_enabled&quot;,
        value: true,
    }
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.80:12000, type: server, namespace: -, table_name: -: RejectedU64MetricValue {
        name: &quot;threads_running_thread_pool&quot;,
        value: 18446744073709551614,
    }
[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.80:7000, type: cluster, namespace: -, table_name: -: RejectedBooleanMetricValue {
        name: &quot;is_load_balancing_enabled&quot;,
        value: false,
    }
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.
</code></pre>
<p>These are some statistics that do not fit the type (both have been solved, but not yet made it to a public release).
The <code>warn</code> level still is reasonably silent.</p>
<p>All available log levels, with increased verbosity are:</p>
<ul>
<li><code>error</code> (default)</li>
<li><code>warn</code></li>
<li><code>info</code></li>
<li><code>debug</code></li>
<li><code>trace</code></li>
</ul>
<p>Please be aware that beyond info, the amount of output can be high.</p>
<h1 id="advanced-logging"><a class="header" href="#advanced-logging">Advanced logging</a></h1>
<p>If you want to understand more about a specific module, you can enable a logging level for that module only. This requires an understanding of the module system in rust, however, the module can be seen in the output such as seen previously:</p>
<pre><code>[2022-10-21T09:38:56Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.80:7000, type: ...
</code></pre>
<p><code>yb_stats::metrics</code> is the module and submodule here.</p>
<p>In order to produce <code>trace</code> level logging for <code>yb_stats::metrics</code> only use:</p>
<pre><code>RUST_LOG=&quot;yb_stats::metrics=trace&quot; yb_stats
</code></pre>
<p>To set different logging levels for different modules, separate them with a comma:</p>
<pre><code>RUST_LOG=&quot;yb_stats::metrics=trace,yb_stats::rpcs=info&quot; ./target/release/yb_stats --snapshot
[2022-10-21T10:01:13Z INFO  yb_stats::rpcs] perform_rpcs_snapshot
[2022-10-21T10:01:13Z INFO  yb_stats::metrics] perform_snapshot (metrics)
[2022-10-21T10:01:13Z INFO  yb_stats::rpcs] Could not parse 192.168.66.82:9300/rpcz json data for rpcs, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z INFO  yb_stats::metrics] (192.168.66.82:9300) error parsing /metrics json data for metrics, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z INFO  yb_stats::rpcs] Could not parse 192.168.66.81:9300/rpcz json data for rpcs, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z INFO  yb_stats::rpcs] Could not parse 192.168.66.80:9300/rpcz json data for rpcs, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z INFO  yb_stats::metrics] (192.168.66.81:9300) error parsing /metrics json data for metrics, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z INFO  yb_stats::metrics] (192.168.66.80:9300) error parsing /metrics json data for metrics, error: expected value at line 1 column 1
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: server, metric_id: yb.ysqlserver, metric_attribute_namespace_name: -, metric_attribute_table_name: -
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: server, metric_id: yb.cqlserver, metric_attribute_namespace_name: -, metric_attribute_table_name: -
[2022-10-21T10:01:13Z WARN  yb_stats::metrics] statistic that is unknown or inconsistent: hostname_port: 192.168.66.82:12000, type: server, namespace: -, table_name: -: RejectedU64MetricValue {
        name: &quot;threads_running_thread_pool&quot;,
        value: 18446744073709551613,
    }
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: server, metric_id: yb.tabletserver, metric_attribute_namespace_name: -, metric_attribute_table_name: -
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: tablet, metric_id: 5abf0e6155ea4f64860325f6cfd2332a, metric_attribute_namespace_name: system, metric_attribute_table_name: transactions
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: tablet, metric_id: e0ac5a9011874a668654e97ca348833d, metric_attribute_namespace_name: system, metric_attribute_table_name: transactions
[2022-10-21T10:01:13Z TRACE yb_stats::metrics] metric_type: tablet, metric_id: 21962b8b5dbd4a6f99c3f3d5bc0780a6, metric_attribute_namespace_name: yugabyte, metric_attribute_table_name: t
</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/troubleshooting.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
