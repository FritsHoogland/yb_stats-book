<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>yb_stats book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="data_sources.html"><strong aria-hidden="true">2.</strong> Data sources</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install</a></li><li class="chapter-item expanded "><a href="running_yb_stats.html"><strong aria-hidden="true">4.</strong> Running yb_stats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specifying_hosts.html"><strong aria-hidden="true">4.1.</strong> Specifying hosts</a></li><li class="chapter-item expanded "><a href="specifying_ports.html"><strong aria-hidden="true">4.2.</strong> Specifying ports</a></li><li class="chapter-item expanded "><a href="specifying_parallel.html"><strong aria-hidden="true">4.3.</strong> Specifying parallel</a></li><li class="chapter-item expanded "><a href="dotenv.html"><strong aria-hidden="true">4.4.</strong> .env</a></li><li class="chapter-item expanded "><a href="snaphost_results.html"><strong aria-hidden="true">4.5.</strong> yb_stats snapshot results</a></li></ol></li><li class="chapter-item expanded "><a href="snapshot_mode.html"><strong aria-hidden="true">5.</strong> Snapshot mode</a></li><li class="chapter-item expanded "><a href="output_modes.html"><strong aria-hidden="true">6.</strong> Output modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ad-hoc_mode.html"><strong aria-hidden="true">6.1.</strong> Ad-hoc mode (in memory diff)</a></li><li class="chapter-item expanded "><a href="ad-hoc_mode.html"><strong aria-hidden="true">6.2.</strong> Snapshot-diff mode</a></li><li class="chapter-item expanded "><a href="print_mode.html"><strong aria-hidden="true">6.3.</strong> Print modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="print_mode_version.html"><strong aria-hidden="true">6.3.1.</strong> print-version</a></li><li class="chapter-item expanded "><a href="print_mode_log.html"><strong aria-hidden="true">6.3.2.</strong> print-log</a></li><li class="chapter-item expanded "><a href="print_mode_gflags.html"><strong aria-hidden="true">6.3.3.</strong> print-gflags</a></li><li class="chapter-item expanded "><a href="print_mode_memtrackers.html"><strong aria-hidden="true">6.3.4.</strong> print-memtrackers</a></li><li class="chapter-item expanded "><a href="print_mode_masters.html"><strong aria-hidden="true">6.3.5.</strong> print-masters</a></li><li class="chapter-item expanded "><a href="print_mode_entities.html"><strong aria-hidden="true">6.3.6.</strong> print-entities</a></li><li class="chapter-item expanded "><a href="print_mode_rpcs.html"><strong aria-hidden="true">6.3.7.</strong> print-rpcs</a></li><li class="chapter-item expanded "><a href="print_mode_threads.html"><strong aria-hidden="true">6.3.8.</strong> print-threads</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="output_metrics_description.html"><strong aria-hidden="true">7.</strong> Output description performance metrics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_value.html"><strong aria-hidden="true">7.1.</strong> Value statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsum.html"><strong aria-hidden="true">7.2.</strong> CountSum statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsumrows.html"><strong aria-hidden="true">7.3.</strong> CountSumRows statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_statement.html"><strong aria-hidden="true">7.4.</strong> Statement statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_nodeexporter.html"><strong aria-hidden="true">7.5.</strong> Node-exporter statistics</a></li></ol></li><li class="chapter-item expanded "><a href="filters.html"><strong aria-hidden="true">8.</strong> Filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="filter_hostname_match.html"><strong aria-hidden="true">8.1.</strong> --hostname-match</a></li><li class="chapter-item expanded "><a href="filter_stat_name_match.html"><strong aria-hidden="true">8.2.</strong> --stat-name-match</a></li><li class="chapter-item expanded "><a href="filter_table_name_match.html"><strong aria-hidden="true">8.3.</strong> --table-name-match</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">yb_stats book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="readme"><a class="header" href="#readme">README</a></h1>
<p>Welcome to the <code>yb_stats</code> book.</p>
<p>This is documentation of the <a href="https://github.com/fritshoogland-yugabyte/yb_stats.git">yb_stats project</a>. </p>
<p><code>yb_stats</code> is a CLI tool to extract all facts from a <a href="https://github.com/yugabyte/yugabyte-db.git">YugabyteDB</a> cluster, and store these in CSV files to persist the facts, and make them easy to transport.</p>
<p>The way <code>yb_stats</code> works is that it tries to obtain information from the http endpoints using the least amount of dependencies, which means using only the <code>yb_stats</code> tool and the http endpoints.</p>
<p>The tools provides 5 general ways of usage:</p>
<ul>
<li>Adhoc mode: extract and store performance metrics into memory, then wait for enter to allow the actions to be investigated be performed, and extract and store the performance metrics into memory again, and show the differences.</li>
<li>Snapshot mode: extract and store all figures to CSV files, and display the snapshot number.</li>
<li>Snapshot-diff mode: extract the performance metrics from CSV files from snapshots of two different snapshots, and show the differences. This performs the same output as ad-hoc mode, but the metrics taken from snapshots instead of ad-hoc.</li>
<li>Print mode: use the print functions for other data than performance metrics to be displayed that are stored in a snapshot, such as version, gflags, etc. </li>
<li>Raw mode: you can always look into the stored CSV files yourself. However, for two sources of data, there is no function in yb_stats to publish the results: http endpoint <code>/pprof/growth</code> output, and <code>/memz</code> output.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>This is an overview of the data sources, the type of daemon where it comes from, the ports (if default), and the http endpoint it is using.</p>
<div class="table-wrapper"><table><thead><tr><th>Datasource</th><th>Type</th><th>Default Port(s)</th><th>Endpoint</th></tr></thead><tbody>
<tr><td>Metrics</td><td>tserver/master</td><td>7000,9000,12000,13000</td><td>/metrics</td></tr>
<tr><td>Statements</td><td>tserver</td><td>13000</td><td>/statements</td></tr>
<tr><td>Metrics</td><td>node-exporter</td><td>9300</td><td>/metrics</td></tr>
<tr><td>Gflags</td><td>tserver/master</td><td>7000,9000</td><td>/varz</td></tr>
<tr><td>Threads</td><td>tserver/master</td><td>7000,9000</td><td>/threadz</td></tr>
<tr><td>Mem-trackers</td><td>tserver/master</td><td>7000,9000</td><td>/mem-trackers</td></tr>
<tr><td>Logging</td><td>tserver/master</td><td>7000,9000</td><td>/logs</td></tr>
<tr><td>Version</td><td>tserver/master</td><td>7000,9000</td><td>/api/v1/version</td></tr>
<tr><td>Entities</td><td>master</td><td>7000</td><td>/dump-entities</td></tr>
<tr><td>Masters</td><td>master</td><td>7000</td><td>/api/v1/masters</td></tr>
<tr><td>RPCs</td><td>tserver/master</td><td>7000,9000,12000,13000</td><td>/rpcz</td></tr>
<tr><td>Pprof</td><td>tserver/master</td><td>7000,9000</td><td>/pprof/growth</td></tr>
<tr><td>Memory breakdown</td><td>tserver/master</td><td>7000,9000</td><td>/memz</td></tr>
</tbody></table>
</div>
<p>Based on the datasources, these are the options for the differences sources:</p>
<div class="table-wrapper"><table><thead><tr><th>Datasource</th><th>Snapshot</th><th>Ad-hoc</th><th>Diff</th><th>Print</th><th>Raw</th></tr></thead><tbody>
<tr><td>Metrics</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Statement</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Metrics</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Gflags</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Thread</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Mem-trackers</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Logging</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Version</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Entities</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Masters</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>RPCs</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td></tr>
<tr><td>Pprof</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td></tr>
<tr><td>Memory breakdown</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td></tr>
</tbody></table>
</div>
<ul>
<li>Snapshot: datasources is captured with the snapshot command.</li>
<li>Ad-hoc: the datasources that are involved in an ad-hoc (non-snapshot) use.</li>
<li>Diff: the datasources that are involved in a snapshot-diff use. This is identical to ad-hoc, but the data taken from snapshots, instead of 'live'.</li>
<li>Print: the datasources that are queryable via a yb_stats print-<datasource> command.</li>
<li>Raw: the datasources that are captured in the snapshot directory, but require reading the file directly, no print or diff command exists.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install"><a class="header" href="#install">Install</a></h1>
<h2 id="mac-osx-via-homebrew"><a class="header" href="#mac-osx-via-homebrew">Mac OSX via <a href="https://brew.sh">homebrew</a></a></h2>
<p>Add the yb_stats &quot;brew tap&quot; (which is a github repository):</p>
<pre><code class="language-shell">brew tap fritshoogland-yugabyte/yb_stats
</code></pre>
<p>Install yb_stats:</p>
<pre><code class="language-shell">brew install yb_stats
</code></pre>
<p>yb_stats is available in /usr/local/bin, which should normally be in $PATH.</p>
<h2 id="rpm-based-distributions"><a class="header" href="#rpm-based-distributions">RPM based distributions</a></h2>
<p>Install the provided yb_stats RPM via yum:</p>
<p>EL7:</p>
<pre><code class="language-shell">sudo yum install https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.7/yb_stats-0.8.7-1.el7.x86_64.rpm
</code></pre>
<p>EL8:</p>
<pre><code class="language-shell">sudo yum install https://github.com/fritshoogland-yugabyte/yb_stats/releases/download/v0.8.7/yb_stats-0.8.7-1.el8.x86_64.rpm
</code></pre>
<p>After yum install, yb_stats is available in /usr/local/bin, which should normally be in $PATH.</p>
<p>These are current latest versions. Look <a href="https://github.com/fritshoogland-yugabyte/yb_stats/releases">yb_stats github repository releases page</a> for newer versions.</p>
<h2 id="mac-osx-compile-from-source"><a class="header" href="#mac-osx-compile-from-source">Mac OSX compile from source</a></h2>
<p>Install Rust via rustup:</p>
<pre><code class="language-shell">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.sh | sh
</code></pre>
<p>Clone the yb_stats repository:</p>
<pre><code class="language-shell">git clone https://github.com/fritshoogland-yugabyte/yb_stats.git
</code></pre>
<p>Build yb_stats:</p>
<pre><code class="language-shell">cd yb_stats
cargo build --release
</code></pre>
<p>yb_stats is in ./target/release/ directory.</p>
<h2 id="linux-compile-from-source"><a class="header" href="#linux-compile-from-source">Linux compile from source</a></h2>
<p>Install dependencies via yum:</p>
<pre><code class="language-shell">sudo yum install -y git openssl-devel gcc
</code></pre>
<p>Install Rust via rustup:</p>
<pre><code class="language-shell">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.sh | sh
</code></pre>
<p>Clone the yb_stats repository:</p>
<pre><code class="language-shell">git clone https://github.com/fritshoogland-yugabyte/yb_stats.git
</code></pre>
<p>Build yb_stats:</p>
<pre><code class="language-shell">cd yb_stats
cargo build --release
</code></pre>
<p>yb_stats is in ./target/release/ directory.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-yb_stats"><a class="header" href="#running-yb_stats">Running yb_stats</a></h1>
<p>Once <code>yb_stats</code> is installed, it can be used to obtain data, and to investigate snapshots.</p>
<p>If <code>yb_stats</code> is run for obtaining data, which means running in ad-hoc mode or snapshot mode, it must be able to access the YugabyteDB cluster nodes, and be allowed to access the different ports. </p>
<p>If <code>yb_stats</code> is run for looking at snapshots, there is no need to access the cluster ip addresses or ports, it will use the snapshot CSV data only.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-hosts"><a class="header" href="#specifying-hosts">Specifying hosts</a></h1>
<p>When <code>yb_stats</code> is used to run in ad-hoc mode or in snapshot mode, the YugabyteDB cluster nodes must be reachable, and <code>yb_stats</code> must be configured to understand the list of nodes. This is done via the switch <code>--hosts</code>, and requires a comma separated list of ip addresses or hostnames.</p>
<p>The default hosts for <code>yb_stats</code> are 192.168.66.80,192.168.66.81,192.168.66.82. This is unlikely to be the same for your use.</p>
<p>Please mind there should not be spaces between the hostnames or ipaddresses and the comma's.</p>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --hosts 10.1.0.1,10.1.0.2,10.1.03
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-ports"><a class="header" href="#specifying-ports">Specifying ports</a></h1>
<p>When <code>yb_stats</code> is used to run in ad-hoc mode or in snapshot mode, the YugabyteDB cluster nodes must be reachable, and <code>yb_stats</code> must be configured to understand the list of nodes. However, it must also connect to the correct port numbers.</p>
<p>In most cases, the port numbers are kept default. When the port numbers are kept default, there is no need to specify ports, and the default list will be okay. So this means that unless one or more default ports have been changed, there is no need to specify ports.</p>
<p>Another reason to specify ports is when for example node-exporter is not installed: specifying the list excluding the node-exporter port YugabyteDB uses (9300) should be done in such a case, although not required.</p>
<p>Please mind the default node-exporter port number is 9000, but that port is taken by the tablet server http endpoint, which is why YugabyteDB uses a different port number for node-exporter.</p>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --ports 7000,9000,12000,13000
</code></pre>
<p>This now excludes the 9300 port for node-exporter.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specifying-parallel"><a class="header" href="#specifying-parallel">Specifying parallel</a></h1>
<p>The amount of parallellism can be set using the <code>--parallel</code> switch. By default, <code>yb_stats</code> uses a single thread for performing the work it is doing. For the work done in the code for each type of data and for fetching the data from the hosts fetching a specific type of data, it can perform work in parallel.</p>
<p>There is no parallellism for obtain the data from the snapshots and presenting it.</p>
<p>Please mind the above description of the way parallellism works in yb_stats means that parallellism is performed in two steps. This means that specifying parallellism should be done with great care not to make the parallellism too high.</p>
<p>The first step in which parallellism is performed is running the code for the specific type of data:</p>
<ul>
<li>tserver, master, YCQL, YSQL metrics,</li>
<li>YSQL statements,</li>
<li>node-exporter metrics,<br />
etc.<br />
This will run <code>--parallel</code> number of threads for each of these types.</li>
</ul>
<p>And then inside the code for tserver metrics, as well as YSQL statements, as well as node-exporter metrics, if <code>--parallel</code> is set to 3, it will loop over the specified nodes and inside that loop over specified ports, which will be done with <code>--parallel</code> number of threads again.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="env"><a class="header" href="#env">.env</a></h1>
<p>Whenever the <code>yb_stats</code> executable is run with <code>--hosts</code>, <code>--ports</code> or <code>--parallel</code> specified, it will use the value of the flag(s) set, but it will also write the specification of hosts, ports or parallellism into a file called <code>.env</code>.</p>
<p>When <code>yb_stats</code> is executed with a <code>.env</code> file in the current working directory, it will set the environment variables listed in that file. If any of:</p>
<ul>
<li>YBSTATS_HOSTS</li>
<li>YBSTATS_PORTS</li>
<li>YBSTATS_PARALLEL<br />
Are set in the <code>.env</code> file, it will use the set value. This way, setting the hosts list, ports list or parallellism only need to be done once, and will be set automatically for every next invocation.</li>
</ul>
<p>If flag is specified with <code>yb_stats</code> that is also set in <code>.env</code>, the flag specified with <code>yb_stats</code> will be given preference, and the entry in <code>.env</code> will be overwritten with this new value.</p>
<p>Please mind that if something is using <code>.env</code> for its own purposes and sets its own values in the file, and <code>yb_stats</code> is run, it will overwrite the file and remove any settings not used with <code>yb_stats</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="yb_stats-snapshot-results"><a class="header" href="#yb_stats-snapshot-results">yb_stats snapshot results</a></h1>
<p>If <code>yb_stats</code> is run with the <code>--snapshot</code> mode switch, it will try to find a directory in the current working directory by the name of <code>yb_stats.snaphots</code>. If it can't find the directory, it will try to create it, and if it fails it will stop.</p>
<p>Inside the <code>yb_stats.snapshots</code> directory the first snapshot will create a CSV file called <code>snapshot.index</code>. This file lists the snapshots taken, comma separated with the following fields:</p>
<ul>
<li>snapshot number</li>
<li>snapshot timestamp</li>
<li>snapshot comments</li>
</ul>
<p>Using this file, <code>yb_stats</code> can understand the snapshot numbers, and add one to the highest number for a new snapshot. </p>
<p>Another use of this file is to obtain the first snapshot timestamp for use with snapshot diffs: if a second snapshot inserts a metric that is not present in the first snapshot, it can safely assume the first snapshot value of that metric to be 0. However, it must make a guess about the approximate first snapshot time; which is where the timestamp is used.</p>
<p>A last use of this file is when <code>yb_stats</code> is run with the <code>--snapshot-list</code> switch: <code>yb_stats</code> will list this information, and quit.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="snapshot-mode"><a class="header" href="#snapshot-mode">snapshot mode</a></h1>
<p>Snapshot mode means fetching all metadata, and store these into CSV files. Snapshot mode does not provide any cluster details, only the number of the new snapshot:</p>
<pre><code class="language-shell">yb_stats --snapshot
snapshot number 2
</code></pre>
<p>Performing a snapshot requires <code>yb_stats</code> to write in the current working directory. </p>
<p>The first step of performing a snapshot is validating if the directory <code>yb_stats.snapshots</code> exists. If it doesn't exist, it will be created. If that fails, which can happen if the directory is not writable for example, then <code>yb_stats</code> stops execution and returns 1 indicating error.</p>
<p>The second step of performing a snapshot is trying to open the file <code>yb_stats.snapshots/snapshot.index</code>. If that file doesn't exist, which is the case if it's the first snapshot, it will return snapshot number 0, the first snapshot. If that file exists, it reads the CSV contents, takes the snapshot numbers, find the max snapshot value and adds 1 to it for the current snapshot number and returns that number. The number then is used to insert the snapshot number, timestamp and comments into the <code>yb_stats.snapshots/snapshot.index</code> file, which is created if it doesn't exist. If anything fails during this step, <code>yb_stats</code> is terminated and returns 1 indicating error.</p>
<p>The third step of performing a snapshot is that a threadpool is build with <code>--parallel</code> threads, which is used to perform the snapshots to CSV for the different datasources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="output-modes"><a class="header" href="#output-modes">Output modes</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ad-hoc-mode"><a class="header" href="#ad-hoc-mode">ad-hoc mode</a></h1>
<p>Ad-hoc mode means fetching the performance metrics and storing these in memory, wait for enter, and after enter is pressed, perform fetching the performance metrics and storing these in memory again, and then subtract the second memory snapshot metrics with the first memory snapshot metrics and show the difference.</p>
<p>This is useful for performing investigations, where this testing does not require to store the data for wider review. Think about cases where repetitive testing of something is performed, which would otherwise result high number of snapshots that will never be used again.</p>
<p>The way to invoke ad-hoc mode is not to specify any option when running <code>yb_stats</code>.
<code>yb_stats</code> will fetch the data, and indicate the metrics snapshot has been performed, and requires pressing the enter key for getting a second/end snapshot for difference calculation:</p>
<pre><code class="language-shell">yb_stats
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.
</code></pre>
<p>Once the first (memory) snapshot is taken, the action that needs investigating can be performed. If that is done, press enter to perform another (memory) snapshot, after which <code>yb_stats</code> will show the differences of the metrics, and the difference divided by the number of seconds between the first and second memory snapshot to get the number per second.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ad-hoc-mode-1"><a class="header" href="#ad-hoc-mode-1">ad-hoc mode</a></h1>
<p>Ad-hoc mode means fetching the performance metrics and storing these in memory, wait for enter, and after enter is pressed, perform fetching the performance metrics and storing these in memory again, and then subtract the second memory snapshot metrics with the first memory snapshot metrics and show the difference.</p>
<p>This is useful for performing investigations, where this testing does not require to store the data for wider review. Think about cases where repetitive testing of something is performed, which would otherwise result high number of snapshots that will never be used again.</p>
<p>The way to invoke ad-hoc mode is not to specify any option when running <code>yb_stats</code>.
<code>yb_stats</code> will fetch the data, and indicate the metrics snapshot has been performed, and requires pressing the enter key for getting a second/end snapshot for difference calculation:</p>
<pre><code class="language-shell">yb_stats
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.
</code></pre>
<p>Once the first (memory) snapshot is taken, the action that needs investigating can be performed. If that is done, press enter to perform another (memory) snapshot, after which <code>yb_stats</code> will show the differences of the metrics, and the difference divided by the number of seconds between the first and second memory snapshot to get the number per second.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-modes"><a class="header" href="#print-modes">Print modes</a></h1>
<p>Outside of performance metrics does a snapshot contain a lot more information. Most of the additonal information can be obtained using print commands. All of the print commands take a single snapshot number, and optional switches to filter output.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-version"><a class="header" href="#print-version">print-version</a></h1>
<p>The <code>--print-version</code> switch takes a single argument, which is a snapshot number.</p>
<p>Additional switches: none.</p>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --print-version 2
hostname_port        version_number  build_nr   build_type build_timestamp          git_hash
192.168.66.82:9000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
192.168.66.82:7000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
192.168.66.81:9000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
192.168.66.81:7000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
192.168.66.80:9000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
192.168.66.80:7000   2.15.2.1        1          RELEASE    10 Oct 2022 19:29:09 UTC 1a6daeb8d9f0eee9a43f529049ef50f4c760adc7
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-log"><a class="header" href="#print-log">print-log</a></h1>
<p>The <code>--print-log</code> switch takes a single argument, which is a snapshot number.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code> to filter one or more hosts</li>
<li><code>--log-severity</code> filters log lines by the letter that indicates the severity. Default: WEF, optional: I.<br />
Explanation of the severity letters:
<ul>
<li>W: Warning</li>
<li>E: Error</li>
<li>F: Fatal</li>
<li>I: Informal</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --print-log 2 --log-severity E
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:12000, Snapshot number: 2, Snapshot time: 2022-10-18 12:33:16.008276 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.82:12000  2022-10-18 12:33:16.008276 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.944s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:12000  2022-10-18 12:33:17.051438 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.857s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:12000  2022-10-18 12:33:18.058483 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.843s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:12000  2022-10-18 12:33:19.062459 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.823s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:9000, Snapshot number: 2, Snapshot time: 2022-10-18 12:33:16.008276 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.82:9000   2022-10-18 12:33:16.008276 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.944s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:9000   2022-10-18 12:33:17.051438 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.857s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:9000   2022-10-18 12:33:18.058483 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.843s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:9000   2022-10-18 12:33:19.062459 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.823s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:7000, Snapshot number: 2, Snapshot time: 2022-10-18 12:33:17.309089 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.82:7000   2022-10-18 12:33:17.309089 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.942s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:7000   2022-10-18 12:33:18.324860 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.947s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
192.168.66.82:7000   2022-10-18 12:33:19.459784 +02:00 E hybrid_clock.cc:181  Too big clock skew is detected: 1.947s, while max allowed is: 0.500s; clock_skew_force_crash_bound_usec=60000000
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.80:12000, Snapshot number: 2, Snapshot time: 2022-10-18 12:32:44.527326 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.80:12000  2022-10-18 12:32:44.527326 +02:00 E async_initializer.cc:95 Failed to initialize client: Timed out (yb/rpc/outbound_call.cc:484): Could not locate the leader master: GetMasterRegistration RPC (request call id 132) to 192.168.66.82:7100 timed out after 0.280sI1018 12:32:45.527978  7488 client-internal.cc:2297] Reinitialize master addresses from file: /opt/yugabyte/conf/tserver.conf
I1018 12:32:45.528049  7488 client-internal.cc:2326] New master addresses: [yb-1.local:7100,yb-2.local:7100,yb-3.local:7100]

--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.80:9000, Snapshot number: 2, Snapshot time: 2022-10-18 12:32:44.527326 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.80:9000   2022-10-18 12:32:44.527326 +02:00 E async_initializer.cc:95 Failed to initialize client: Timed out (yb/rpc/outbound_call.cc:484): Could not locate the leader master: GetMasterRegistration RPC (request call id 132) to 192.168.66.82:7100 timed out after 0.280sI1018 12:32:45.527978  7488 client-internal.cc:2297] Reinitialize master addresses from file: /opt/yugabyte/conf/tserver.conf
I1018 12:32:45.528049  7488 client-internal.cc:2326] New master addresses: [yb-1.local:7100,yb-2.local:7100,yb-3.local:7100]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-gflags"><a class="header" href="#print-gflags">print-gflags</a></h1>
<p>The <code>--print-gflags</code> switch takes a single argument, which is a snapshot number.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code> to filter one or more hosts.</li>
<li><code>--stat-name-match</code> to filter by one or more gflag names.</li>
</ul>
<p>Example:</p>
<pre><code class="language-shell"> yb_stats --print-gflags 2 --hostname-match 82:700 --stat-name-match wal
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:7000, Snapshot number: 2, Snapshot time: 2022-10-18 15:26:20.128980 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
cdc_wal_retention_time_secs                                                      14400
time_based_wal_gc_clock_delta_usec                                               0
bytes_durable_wal_write_mb                                                       1
durable_wal_write                                                                true
interval_durable_wal_write_ms                                                    1000
require_durable_wal_write                                                        false
save_index_into_wal_segments                                                     false
fs_wal_dirs                                                                      /mnt/d0
skip_wal_rewrite                                                                 true
TEST_download_partial_wal_segments                                               false
TEST_pause_rbs_before_download_wal                                               false
TEST_fault_crash_after_wal_deleted                                               0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-memtrackers"><a class="header" href="#print-memtrackers">print-memtrackers</a></h1>
<p>The <code>--print-memtrackers</code> switch takes a single argument, which is a snapshot number.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code> to filter one or more hosts.</li>
<li><code>--stat-name-match</code> to filter on the memory names as seen as 'id' in the output.</li>
</ul>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --print-memtrackers 2 --hostname-match 82:700 --stat-name-match '(root|TCMalloc|server)'
--------------------------------------------------------------------------------------------------------------------------------------
Host: 192.168.66.82:7000, Snapshot number: 2, Snapshot time: 2022-10-18 15:26:20.125948 +02:00
--------------------------------------------------------------------------------------------------------------------------------------
hostname_port        id                                                  current_consumption     peak_consumption                limit
--------------------------------------------------------------------------------------------------------------------------------------
192.168.66.82:7000   root                                                             26.86M               28.09M              241.44M
192.168.66.82:7000   TCMalloc Central Cache                                           812.7K               961.9K                 none
192.168.66.82:7000   TCMalloc PageHeap Free                                            2.26M                4.73M                 none
192.168.66.82:7000   TCMalloc Thread Cache                                            716.9K                1.97M                 none
192.168.66.82:7000   TCMalloc Transfer Cache                                          985.5K                1.41M                 none
192.168.66.82:7000   server                                                  197.5K (12.62M)               232.1K                 none
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-masters"><a class="header" href="#print-masters">print-masters</a></h1>
<p>The <code>--print-masters</code> siwtch takes a single argument, which is a snapshot number.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code> to filter one or more hosts.</li>
</ul>
<p>Example:</p>
<pre><code class="language-shell">yb_stats --print-masters 2 --hostname-match 80
--------------------------------------------------------------------------------
Source host: 192.168.66.80:7000, snapshot time: 2022-10-18 15:26:20.210094 +02:00
--------------------------------------------------------------------------------
Permanent UUID:1a11d26f9add4b799c23a1660fd0418d, Instance Seqno:1666096364509506, Start time:1666096364509506us, Cloud:local, Region:local, Zone:local, Role:FOLLOWER
RPC addresses: ( yb-2.local:7100  )
HTTP addresses: ( yb-2.local:7000  )
Permanent UUID:748f9c424d114586b29a0311d0ac4d75, Instance Seqno:1666096333830061, Start time:1666096333830061us, Cloud:local, Region:local, Zone:local, Role:LEADER
RPC addresses: ( yb-1.local:7100  )
HTTP addresses: ( yb-1.local:7000  )
Permanent UUID:c15b0b8033574547946b9aa9fdde9336, Instance Seqno:1666096396652361, Start time:1666096396652361us, Cloud:local, Region:local, Zone:local, Role:FOLLOWER
RPC addresses: ( yb-3.local:7100  )
HTTP addresses: ( yb-3.local:7000  )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-entities"><a class="header" href="#print-entities">print-entities</a></h1>
<p>The <code>--print-entities</code> siwtch takes a single argument, which is a snapshot number.</p>
<p>Additional switches:</p>
<ul>
<li><code>--hostname-match</code> to filter one or more entity source hosts.</li>
<li><code>--table-name-match</code> to filter an object name.</li>
</ul>
<p>When using <code>--print-entities</code> to find objects and their layout on a cluster, be aware that all masters, so the leader as well as the followers provide data via the /dump-entities endpoint. Using the entities information from multiple masters can be handy to validate synchronisation and split-brain situations, but the most common usecase that I see would be to lookup objects.</p>
<p>Looking up object is most logical to do from the master leader, because that would be place where the cluster will get its data. Two common ways of doing that are:</p>
<ul>
<li>Using <code>--print-masters</code> for the snapshot number you want to use, and then look for the Role:LEADER.</li>
<li>Use <code>--snapshot-diff</code>: </li>
</ul>
<pre><code class="language-shell">yb_stats --snapshot-diff --hostname-match 7000 --gauges-enable --stat-name-match is_raft_leader -b 1 -e 2
192.168.66.80:7000   tablet   is_raft_leader                                                                       1 y/n                 +1
</code></pre>
<p>This shows that master 192.168.66.80:7000 was LEADER at end snapshot <code>2</code>, and the <code>+1</code> says that it wasn't the LEADER in snapshot 1. </p>
<p>Now with this information, use <code>--hostname-match</code> to filter the master LEADER output for the snapshot, and <code>--table-name-match</code> for the object you want to see:</p>
<pre><code class="language-shell">yb_stats --print-entities 2 --hostname-match 80 --table-name-match transactions
192.168.66.80:7000 ycql system transactions d75b983d5f8548c282034129fc2300d1 RUNNING
tablet:1150848aeb004a1b813d208c7cc60f23 RUNNING : ( VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,FOLLOWER )
tablet:3c7ece0980cc4755a97b6ceb2df6845e RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER VOTER,yb-2.local:9100,FOLLOWER )
tablet:4b723064c6064a36afb822d8125ae24d RUNNING : ( VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,FOLLOWER )
tablet:4ea37645092f46068250b46551623c85 RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER VOTER,yb-2.local:9100,FOLLOWER )
tablet:4eca47aa83dd47a3bc7e1d54474ddaa4 RUNNING : ( VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,FOLLOWER )
tablet:540c6c39858d4679bf6a1ffa41417be8 RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER VOTER,yb-2.local:9100,FOLLOWER )
tablet:5abf0e6155ea4f64860325f6cfd2332a RUNNING : ( VOTER,yb-1.local:9100,LEADER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,FOLLOWER )
tablet:a0820acf79bb425ea30b511e5166830e RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,LEADER VOTER,yb-2.local:9100,FOLLOWER )
tablet:d4012adab48741f98d9287715e4f94a5 RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,LEADER )
tablet:e0ac5a9011874a668654e97ca348833d RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,LEADER )
tablet:eb0f8f0ea4c446c3912ab7fe45846d0a RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,LEADER )
tablet:f89c996a4b724e28804d3aadfcc0c75e RUNNING : ( VOTER,yb-1.local:9100,FOLLOWER VOTER,yb-3.local:9100,FOLLOWER VOTER,yb-2.local:9100,LEADER )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-rpcs"><a class="header" href="#print-rpcs">print-rpcs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-threads"><a class="header" href="#print-threads">print-threads</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="output-description-performance-metrics"><a class="header" href="#output-description-performance-metrics">Output description performance metrics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="value-statistics"><a class="header" href="#value-statistics">Value statistics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="countsum-statistics"><a class="header" href="#countsum-statistics">CountSum statistics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="countsumrows-statistics"><a class="header" href="#countsumrows-statistics">CountSumRows statistics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="statement-statistics"><a class="header" href="#statement-statistics">Statement statistics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="node-exporter-statistics"><a class="header" href="#node-exporter-statistics">Node-exporter statistics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filters"><a class="header" href="#filters">filters</a></h1>
<p>The different 'query modes' of <code>yb_stats</code>, which are ad-hoc mode, snapshot mode and the print modes, allow to filter data based on different criteria. This is very useful, because most sources of data contain lots of information, which could make it hard to find what you are looking for.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="--hostname-match"><a class="header" href="#--hostname-match">--hostname-match</a></h1>
<p>Most <code>yb_stats</code> query options allow to filter on hostname. This is done with the <code>--hostname-match</code> switch. The hostname match switch uses a regex to filter out entries using the hostname:port specification.</p>
<p>Very simple use of <code>--hostname-match</code> is to filter on the port number, to specify only the tablet servers:</p>
<pre><code class="language-shell">yb_stats --hostname-match 9000
</code></pre>
<p>Or specify to use only the tablet server and master servers, thereby filtering the node-exporter output:</p>
<pre><code class="language-shell">yb_stats --hostname-match '(7000|9000)'
</code></pre>
<p>Because the filter is based on regex pattern matching, it is also easy to specify a master (=7000) for a class C ip network with hostnumber 82 (class C means for example 192.168.66/24, so one octet remains, so '82'), which means you can filter in this way:</p>
<pre><code class="language-shell">yb_stats --hostname-match '82:7000'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="--stat-name-match"><a class="header" href="#--stat-name-match">--stat-name-match</a></h1>
<p>For the statistic names with the performance metrics for a memory or snapshot diff, as well as for the gflags name and mem-trackers id values, it is possible to filter. The filter name for that is <code>--stat-name-match</code>. This is a regex for filtering.</p>
<p>For example if you are only interested in master and tserver cpu statistics:</p>
<pre><code class="language-shell">yb_stats --stat-name-match 'cpu_.time'
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.900 seconds
192.168.66.80:12000  server   cpu_stime                              15 ms              16.502 /s
192.168.66.80:7000   server   cpu_stime                               2 ms               2.200 /s
192.168.66.80:7000   server   cpu_utime                               8 ms               8.801 /s
192.168.66.80:9000   server   cpu_stime                              14 ms              15.402 /s
192.168.66.81:12000  server   cpu_stime                               6 ms               6.608 /s
192.168.66.81:12000  server   cpu_utime                               9 ms               9.912 /s
192.168.66.81:7000   server   cpu_stime                               8 ms               8.801 /s
192.168.66.81:9000   server   cpu_stime                               7 ms               7.709 /s
192.168.66.81:9000   server   cpu_utime                               9 ms               9.912 /s
192.168.66.82:12000  server   cpu_stime                               6 ms               6.645 /s
192.168.66.82:12000  server   cpu_utime                              10 ms              11.074 /s
192.168.66.82:7000   server   cpu_utime                               8 ms               8.840 /s
192.168.66.82:9000   server   cpu_stime                               6 ms               6.637 /s
192.168.66.82:9000   server   cpu_utime                              11 ms              12.168 /s
</code></pre>
<p>Or a more sophisticated filter to look at tserver and master cpu time, as well as voluntary and involuntary context switches:</p>
<pre><code class="language-shell">yb_stats --stat-name-match '(cpu_.time|voluntary_context_switches)'
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.915 seconds
192.168.66.80:12000  server   cpu_utime                               12 ms              13.086 /s
192.168.66.80:12000  server   voluntary_context_switches             234 csws           255.180 /s
192.168.66.80:7000   server   cpu_stime                                2 ms               2.181 /s
192.168.66.80:7000   server   cpu_utime                                9 ms               9.815 /s
192.168.66.80:7000   server   voluntary_context_switches             105 csws           114.504 /s
192.168.66.80:9000   server   cpu_utime                                13 ms              14.177 /s
192.168.66.80:9000   server   voluntary_context_switches             235 csws           256.270 /s
192.168.66.81:12000  server   cpu_stime                                6 ms               6.550 /s
192.168.66.81:12000  server   cpu_utime                                8 ms               8.734 /s
192.168.66.81:12000  server   voluntary_context_switches             262 csws           286.026 /s
192.168.66.81:7000   server   cpu_utime                                7 ms               7.625 /s
192.168.66.81:7000   server   voluntary_context_switches              70 csws            76.253 /s
192.168.66.81:9000   server   cpu_stime                                6 ms               6.543 /s
192.168.66.81:9000   server   cpu_utime                                8 ms               8.724 /s
192.168.66.81:9000   server   voluntary_context_switches             263 csws           286.805 /s
192.168.66.82:12000  server   cpu_stime                                6 ms               6.565 /s
192.168.66.82:12000  server   cpu_utime                                8 ms               8.753 /s
192.168.66.82:12000  server   voluntary_context_switches             272 csws           297.593 /s
192.168.66.82:7000   server   cpu_utime                                8 ms               8.762 /s
192.168.66.82:7000   server   voluntary_context_switches              65 csws            71.194 /s
192.168.66.82:9000   server   cpu_stime                                6 ms               6.565 /s
192.168.66.82:9000   server   cpu_utime                                8 ms               8.753 /s
192.168.66.82:9000   server   voluntary_context_switches             269 csws           294.311 /s
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="--table-name-match"><a class="header" href="#--table-name-match">--table-name-match</a></h1>
<p><code>yb_stats</code> by default sums up per table and tablet statistics per hostname-port number combination, to try to sensibly reduce the amount of output. However, <code>yb_stats</code> can be set to display per table and tablet statistics individually using the <code>--details-enable</code> switch.</p>
<p>If the <code>--details-enable</code> switch is set, the table name is stored with the statistics for both the table and tablet data. The <code>--table-name-match</code> switch allows you to filter on the table name, to have the ability to look at the statistics of only the tables of interest.</p>
<p>Additionally, the <code>--table-name-match</code> switch can also be used for the printing the details of the entities data, which also are tables.</p>
<p>Example: filter for the sys.catalog (postgres catalog) entries in the master. Please mind the <code>--hostname-match</code> option is also used, because otherwise the node-exporter output would still be shown, because that data is not filtered by <code>--table-name-match</code></p>
<pre><code class="language-shell">yb_stats --details-enable --table-name-match catalog --hostname-match 7000
Begin metrics snapshot created, press enter to create end snapshot for difference calculation.

Time between snapshots:    0.679 seconds
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_bytes_read                       300447 bytes       441185.022 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_data_hit                              6 blocks           8.811 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_hit                                  15 blocks          22.026 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_index_hit                             9 blocks          13.216 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_single_touch_bytes_read          300447 bytes       441185.022 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_block_cache_single_touch_hit                     15 blocks          22.026 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_db_iter_bytes_read                              618 bytes          907.489 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_no_table_cache_iterators                          6 iters            8.811 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_number_db_next                                    9 keys            13.216 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_number_db_next_found                              9 keys            13.216 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_number_db_seek                                    6 keys             8.811 /s
192.168.66.80:7000   tablet   000000000000000                 sys.catalog                    rocksdb_number_db_seek_found                              6 keys             8.811 /s
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
