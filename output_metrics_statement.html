<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Statement statistics - yb_stats book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="data_sources.html"><strong aria-hidden="true">2.</strong> Data sources</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="upgrade.html"><strong aria-hidden="true">3.1.</strong> Upgrade</a></li></ol></li><li class="chapter-item expanded "><a href="running_yb_stats.html"><strong aria-hidden="true">4.</strong> Running yb_stats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specifying_hosts.html"><strong aria-hidden="true">4.1.</strong> Specifying hosts</a></li><li class="chapter-item expanded "><a href="specifying_ports.html"><strong aria-hidden="true">4.2.</strong> Specifying ports</a></li><li class="chapter-item expanded "><a href="specifying_parallel.html"><strong aria-hidden="true">4.3.</strong> Specifying parallel</a></li><li class="chapter-item expanded "><a href="dotenv.html"><strong aria-hidden="true">4.4.</strong> .env</a></li><li class="chapter-item expanded "><a href="snapshot_results.html"><strong aria-hidden="true">4.5.</strong> yb_stats --snapshot</a></li><li class="chapter-item expanded "><a href="snapshot_results_extra_data.html"><strong aria-hidden="true">4.6.</strong> yb_stats --snapshot --extra-data</a></li></ol></li><li class="chapter-item expanded "><a href="output_modes.html"><strong aria-hidden="true">5.</strong> Output modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="snapshot_usage.html"><strong aria-hidden="true">5.1.</strong> Using snapshots</a></li><li class="chapter-item expanded "><a href="filters.html"><strong aria-hidden="true">5.2.</strong> Data filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="filter_hostname_match.html"><strong aria-hidden="true">5.2.1.</strong> --hostname-match</a></li><li class="chapter-item expanded "><a href="filter_stat_name_match.html"><strong aria-hidden="true">5.2.2.</strong> --stat-name-match</a></li><li class="chapter-item expanded "><a href="filter_table_name_match.html"><strong aria-hidden="true">5.2.3.</strong> --table-name-match</a></li></ol></li><li class="chapter-item expanded "><a href="data_enrichment.html"><strong aria-hidden="true">5.3.</strong> Data enrichment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_mode_gauges.html"><strong aria-hidden="true">5.3.1.</strong> --gauges-enable</a></li><li class="chapter-item expanded "><a href="output_mode_details-enable.html"><strong aria-hidden="true">5.3.2.</strong> --details-enable</a></li></ol></li><li class="chapter-item expanded "><a href="adhoc_results.html"><strong aria-hidden="true">5.4.</strong> yb_stats</a></li><li class="chapter-item expanded "><a href="output_mode_snapshot-diff.html"><strong aria-hidden="true">5.5.</strong> yb_stats --snapshot-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_mode_metrics-diff.html"><strong aria-hidden="true">5.5.1.</strong> yb_stats --metrics-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics.html"><strong aria-hidden="true">5.5.1.1.</strong> Metrics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_value.html"><strong aria-hidden="true">5.5.1.1.1.</strong> Value statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsum.html"><strong aria-hidden="true">5.5.1.1.2.</strong> CountSum statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsumrows.html"><strong aria-hidden="true">5.5.1.1.3.</strong> CountSumRows statistics</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="output_mode_node-exporter-diff.html"><strong aria-hidden="true">5.5.2.</strong> yb_stats --node-exporter-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_nodeexporter.html"><strong aria-hidden="true">5.5.2.1.</strong> Node-exporter statistics</a></li></ol></li><li class="chapter-item expanded "><a href="output_mode_statements-diff.html"><strong aria-hidden="true">5.5.3.</strong> yb_stats --statements-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_statement.html" class="active"><strong aria-hidden="true">5.5.3.1.</strong> Statement statistics</a></li></ol></li><li class="chapter-item expanded "><a href="output_mode_versions-diff.html"><strong aria-hidden="true">5.5.4.</strong> yb_stats --versions-diff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_version_diff.html"><strong aria-hidden="true">5.5.4.1.</strong> Version diff</a></li></ol></li><li class="chapter-item expanded "><a href="output_entity-diff.html"><strong aria-hidden="true">5.5.5.</strong> yb_stats --entity-diff</a></li><li class="chapter-item expanded "><a href="output_masters-diff.html"><strong aria-hidden="true">5.5.6.</strong> yb_stats --masters-diff</a></li><li class="chapter-item expanded "><a href="output_tablet-servers-diff.html"><strong aria-hidden="true">5.5.7.</strong> yb_stats --tablet-servers-diff</a></li><li class="chapter-item expanded "><a href="output_vars-diff.html"><strong aria-hidden="true">5.5.8.</strong> yb_stats --vars-diff</a></li><li class="chapter-item expanded "><a href="output_healthcheck-diff.html"><strong aria-hidden="true">5.5.9.</strong> yb_stats --healthcheck-diff</a></li></ol></li><li class="chapter-item expanded "><a href="output_mode_snapshot-nonmetrics-diff.html"><strong aria-hidden="true">5.6.</strong> yb_stats --snapshot-nonmetrics-diff</a></li><li class="chapter-item expanded "><a href="output_mode_adhoc-metrics-diff.html"><strong aria-hidden="true">5.7.</strong> yb_stats --adhoc-metrics-diff</a></li><li class="chapter-item expanded "><a href="output_mode_adhoc-node-exporter-diff.html"><strong aria-hidden="true">5.8.</strong> yb_stats --adhoc-node-exporter-diff</a></li><li class="chapter-item expanded "><a href="print_mode.html"><strong aria-hidden="true">5.9.</strong> Print modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="print_mode_version.html"><strong aria-hidden="true">5.9.1.</strong> --print-version</a></li><li class="chapter-item expanded "><a href="print_mode_log.html"><strong aria-hidden="true">5.9.2.</strong> --print-log</a></li><li class="chapter-item expanded "><a href="tail_mode_log.html"><strong aria-hidden="true">5.9.3.</strong> --tail-log</a></li><li class="chapter-item expanded "><a href="print_mode_entities.html"><strong aria-hidden="true">5.9.4.</strong> --print-entities</a></li><li class="chapter-item expanded "><a href="print_mode_masters.html"><strong aria-hidden="true">5.9.5.</strong> --print-masters</a></li><li class="chapter-item expanded "><a href="print_mode_tablet_servers.html"><strong aria-hidden="true">5.9.6.</strong> --print-tablet-servers</a></li><li class="chapter-item expanded "><a href="print_mode_vars.html"><strong aria-hidden="true">5.9.7.</strong> --print-vars</a></li><li class="chapter-item expanded "><a href="print_mode_memtrackers.html"><strong aria-hidden="true">5.9.8.</strong> --print-memtrackers</a></li><li class="chapter-item expanded "><a href="print_mode_rpcs.html"><strong aria-hidden="true">5.9.9.</strong> --print-rpcs</a></li><li class="chapter-item expanded "><a href="print_mode_threads.html"><strong aria-hidden="true">5.9.10.</strong> --print-threads</a></li><li class="chapter-item expanded "><a href="print_mode_gflags.html"><strong aria-hidden="true">5.9.11.</strong> --print-gflags</a></li><li class="chapter-item expanded "><a href="print_mode_cluster-config.html"><strong aria-hidden="true">5.9.12.</strong> --print-cluster-config</a></li><li class="chapter-item expanded "><a href="print_mode_health-check.html"><strong aria-hidden="true">5.9.13.</strong> --print-health-check</a></li><li class="chapter-item expanded "><a href="print_mode_drives.html"><strong aria-hidden="true">5.9.14.</strong> --print-drives</a></li><li class="chapter-item expanded "><a href="print_mode_tablet-server-operations.html"><strong aria-hidden="true">5.9.15.</strong> --print-tablet-server-operations</a></li><li class="chapter-item expanded "><a href="print_mode_master-tasks.html"><strong aria-hidden="true">5.9.16.</strong> --print-master-tasks</a></li><li class="chapter-item expanded "><a href="print_mode_table-detail.html"><strong aria-hidden="true">5.9.17.</strong> --print-table-detail</a></li><li class="chapter-item expanded "><a href="print_mode_tablet-detail.html"><strong aria-hidden="true">5.9.18.</strong> --print-tablet-detail</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="crontab.html"><strong aria-hidden="true">6.</strong> Crontab</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">7.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">yb_stats book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="statement-statistics"><a class="header" href="#statement-statistics">Statement statistics</a></h1>
<p>In the output generated by ad-hoc or snapshot-diff mode, a fourth group that optionally can be shown are statement statistics.
These statistics are taken from the YSQL (normally port 13000) http endpoint. 
If no SQL interaction did happen between YSQL/postgres and DocDB, then there will be no statements shown.</p>
<p>This is how the statement output looks like:</p>
<pre><code>192.168.66.80:13000          98 avg:           0.002 tot:           0.156 ms avg:          0 tot:          0 rows: begin
192.168.66.80:13000          98 avg:           0.003 tot:           0.305 ms avg:          0 tot:          0 rows: commit
192.168.66.80:13000          98 avg:          78.722 tot:        7714.786 ms avg:       1020 tot:     100000 rows: copy ysql_bench_accounts from stdin
192.168.66.80:13000           1 avg:         456.096 tot:         456.096 ms avg:          0 tot:          0 rows: create table ysql_bench_accounts(aid    int not null,bid int,abalance int,filler
192.168.66.80:13000           1 avg:         451.798 tot:         451.798 ms avg:          0 tot:          0 rows: create table ysql_bench_branches(bid int not null,bbalance int,filler char(88),P
192.168.66.80:13000           1 avg:         483.839 tot:         483.839 ms avg:          0 tot:          0 rows: create table ysql_bench_history(tid int,bid int,aid    int,delta int,mtime times
192.168.66.80:13000           1 avg:         394.892 tot:         394.892 ms avg:          0 tot:          0 rows: create table ysql_bench_tellers(tid int not null,bid int,tbalance int,filler cha
192.168.66.80:13000           1 avg:         569.624 tot:         569.624 ms avg:          0 tot:          0 rows: drop table if exists ysql_bench_accounts, ysql_bench_branches, ysql_bench_histor
192.168.66.80:13000           1 avg:          11.560 tot:          11.560 ms avg:          1 tot:          1 rows: insert into ysql_bench_branches(bid,bbalance) values($1,$2)
192.168.66.80:13000          10 avg:           8.218 tot:          82.179 ms avg:          1 tot:         10 rows: insert into ysql_bench_tellers(tid,bid,tbalance) values ($1,$2,$3)
192.168.66.80:13000           1 avg:        6641.962 tot:        6641.962 ms avg:          0 tot:          0 rows: truncate table ysql_bench_accounts, ysql_bench_branches, ysql_bench_history, ysq
</code></pre>
<p>Explanation:</p>
<div class="table-wrapper"><table><thead><tr><th>hostname:port</th><th>calls</th><th>total_time / calls</th><th>total_time</th><th>unit total_time</th><th>rows / calls</th><th>total rows</th><th>query</th></tr></thead><tbody>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:    0.002</td><td>tot:    0.156</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>begin</td></tr>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:    0.003</td><td>tot:    0.305</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>commit</td></tr>
<tr><td>192.168.66.80:13000</td><td>98</td><td>avg:   78.722</td><td>tot: 7714.786</td><td>ms</td><td>avg: 1020</td><td>tot: 100000 rows</td><td>copy ysql_bench_accounts from stdin</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  456.096</td><td>tot:  456.096</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_accounts(aid    int not null,bid int,abalance int,filler</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  451.798</td><td>tot:  451.798</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_branches(bid int not null,bbalance int,filler char(88),P</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  483.839</td><td>tot:  483.839</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_history(tid int,bid int,aid    int,delta int,mtime times</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  394.892</td><td>tot:  394.892</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>create table ysql_bench_tellers(tid int not null,bid int,tbalance int,filler cha</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:  569.624</td><td>tot:  569.624</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>drop table if exists ysql_bench_accounts, ysql_bench_branches, ysql_bench_histor</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg:   11.560</td><td>tot:   11.560</td><td>ms</td><td>avg:    1</td><td>tot:      1 rows</td><td>insert into ysql_bench_branches(bid,bbalance) values($1,$2)</td></tr>
<tr><td>192.168.66.80:13000</td><td>10</td><td>avg:    8.218</td><td>tot:   82.179</td><td>ms</td><td>avg:    1</td><td>tot:     10 rows</td><td>insert into ysql_bench_tellers(tid,bid,tbalance) values ($1,$2,$3)</td></tr>
<tr><td>192.168.66.80:13000</td><td>1</td><td>avg: 6641.962</td><td>tot: 6641.962</td><td>ms</td><td>avg:    0</td><td>tot:      0 rows</td><td>truncate table ysql_bench_accounts, ysql_bench_branches, ysql_bench_history, ysq</td></tr>
</tbody></table>
</div>
<p>For the sake of simplicity, any identical SQL (based on the query text) is summed up, and assumed to be the same statement. This is not correct. (at the time of creation, query_id was not exposed, so this was the only solution)</p>
<p>Please mind the source of the SQL statistics is postgres' pg_stat_statements, and holds a few quirks:</p>
<ul>
<li>Any SQL that returns an error is not saved in 'pg_stat_statements'.</li>
<li>The 'total_time' is actually the time spent in the <em>execution phase</em>. Especially since YSQL might need to perform RPCs to complete its catalog (in rewrite/semantic parse and plan phases), this can miss some time and therefore show less time than a client sees.</li>
<li>A statement's uniqueness in pg_stat_statements is dependent on query_id, dbid and userid. Currently we don't expose all this fields in the http endpoint.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_statement.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="output_mode_statements-diff.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="output_mode_versions-diff.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="output_mode_statements-diff.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="output_mode_versions-diff.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
