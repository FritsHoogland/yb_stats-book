<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Statement statistics - yb_stats book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="data_sources.html"><strong aria-hidden="true">2.</strong> Data sources</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install</a></li><li class="chapter-item expanded "><a href="running_yb_stats.html"><strong aria-hidden="true">4.</strong> Running yb_stats</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="specifying_hosts.html"><strong aria-hidden="true">4.1.</strong> Specifying hosts</a></li><li class="chapter-item expanded "><a href="specifying_ports.html"><strong aria-hidden="true">4.2.</strong> Specifying ports</a></li><li class="chapter-item expanded "><a href="specifying_parallel.html"><strong aria-hidden="true">4.3.</strong> Specifying parallel</a></li><li class="chapter-item expanded "><a href="dotenv.html"><strong aria-hidden="true">4.4.</strong> .env</a></li><li class="chapter-item expanded "><a href="snaphost_results.html"><strong aria-hidden="true">4.5.</strong> yb_stats snapshot results</a></li></ol></li><li class="chapter-item expanded "><a href="snapshot_mode.html"><strong aria-hidden="true">5.</strong> Snapshot mode</a></li><li class="chapter-item expanded "><a href="output_modes.html"><strong aria-hidden="true">6.</strong> Output modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_mode_ad-hoc.html"><strong aria-hidden="true">6.1.1.</strong> Ad-hoc mode (in memory diff)</a></li><li class="chapter-item expanded "><a href="output_mode_snapshot-diff.html"><strong aria-hidden="true">6.1.2.</strong> Snapshot-diff mode</a></li><li class="chapter-item expanded "><a href="output_mode_gauges.html"><strong aria-hidden="true">6.1.3.</strong> --gauges-enable</a></li><li class="chapter-item expanded "><a href="output_mode_details-enable.html"><strong aria-hidden="true">6.1.4.</strong> --details-enable</a></li><li class="chapter-item expanded "><a href="filters.html"><strong aria-hidden="true">6.1.5.</strong> Filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="filter_hostname_match.html"><strong aria-hidden="true">6.1.5.1.</strong> --hostname-match</a></li><li class="chapter-item expanded "><a href="filter_stat_name_match.html"><strong aria-hidden="true">6.1.5.2.</strong> --stat-name-match</a></li><li class="chapter-item expanded "><a href="filter_table_name_match.html"><strong aria-hidden="true">6.1.5.3.</strong> --table-name-match</a></li></ol></li><li class="chapter-item expanded "><a href="output_metrics_description.html"><strong aria-hidden="true">6.1.6.</strong> Output description</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="output_metrics_value.html"><strong aria-hidden="true">6.1.6.1.</strong> Value statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsum.html"><strong aria-hidden="true">6.1.6.2.</strong> CountSum statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_countsumrows.html"><strong aria-hidden="true">6.1.6.3.</strong> CountSumRows statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_statement.html" class="active"><strong aria-hidden="true">6.1.6.4.</strong> Statement statistics</a></li><li class="chapter-item expanded "><a href="output_metrics_nodeexporter.html"><strong aria-hidden="true">6.1.6.5.</strong> Node-exporter statistics</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="print_mode.html"><strong aria-hidden="true">6.2.</strong> Print modes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="print_mode_version.html"><strong aria-hidden="true">6.2.1.</strong> print-version</a></li><li class="chapter-item expanded "><a href="print_mode_log.html"><strong aria-hidden="true">6.2.2.</strong> print-log</a></li><li class="chapter-item expanded "><a href="print_mode_gflags.html"><strong aria-hidden="true">6.2.3.</strong> print-gflags</a></li><li class="chapter-item expanded "><a href="print_mode_memtrackers.html"><strong aria-hidden="true">6.2.4.</strong> print-memtrackers</a></li><li class="chapter-item expanded "><a href="print_mode_masters.html"><strong aria-hidden="true">6.2.5.</strong> print-masters</a></li><li class="chapter-item expanded "><a href="print_mode_entities.html"><strong aria-hidden="true">6.2.6.</strong> print-entities</a></li><li class="chapter-item expanded "><a href="print_mode_rpcs.html"><strong aria-hidden="true">6.2.7.</strong> print-rpcs</a></li><li class="chapter-item expanded "><a href="print_mode_threads.html"><strong aria-hidden="true">6.2.8.</strong> print-threads</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="crontab.html"><strong aria-hidden="true">7.</strong> Crontab</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">yb_stats book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="statement-statistics"><a class="header" href="#statement-statistics">Statement statistics</a></h1>
<p>In the output generated by ad-hoc or snapshot-diff mode, a fourth group that optionally can be shown are statement statistics. These statistics are taken from the YSQL (normally port 13000) http endpoint. If no SQL interaction did happen between YSQL/postgres and DocDB, then there will be no statements shown.</p>
<p>This is how the statement output looks like:</p>
<pre><code>192.168.66.80:13000           1 avg:          18.552 tot:          18.552 ms avg:          1 tot:          1 rows: insert into t values ($1, $2)
</code></pre>
<ul>
<li>The first column contains the ip address or hostname a colon and the port number.</li>
<li>The second column contains the number of calls of this SQL statement, where the number of calls is the difference of the number of calls between the END and BEGIN snapshots.</li>
<li>The third column (skipping counting 'avg:' ) is the average total_time per call, which is calculated as the difference of the total_time between the END and BEGIN snapshots divided by the difference of the number of calls between the END and BEGIN snapshots.</li>
<li>The fourth column (skipping counting 'tot:') is the total_time, which is calculated as the difference of the total_time between the END and BEGIN snapshots.</li>
<li>The fifth column (skipping counting 'ms avg:') is the average number of rows, which is calculated as the difference of rows between END and BEGIN snapshots divided by the difference in calls between the END and BEGIN snapshots.</li>
<li>The sixth column (skipping counting 'tot:') is the total number of rows, which is calculated as the difference of rows between END and BEGIN snapshots.</li>
<li>The seventh column (skipping counting 'rows:' is the SQL statement. Th maximal length of the SQL statement shown is 80 characters, and can be changed by the <code>--sql-length</code> parameter and a number.</li>
</ul>
<p>For the sake of simplicity, any identical SQL (based on the query text) is summed up, and assumed to be the same statement. This is not correct. (at the time of creation, query_id was not exposed, so this was the only solution)</p>
<p>Please mind the source of the SQL statistics is postgres' pg_stat_statements, and holds a few quirks:</p>
<ul>
<li>Any SQL that returns an error is not saved in 'pg_stat_statements'.</li>
<li>The 'total_time' is actually the time spent in the <em>execution phase</em>. Especially since YSQL might need to perform RPCs to complete its catalog (in rewrite/semantic parse and plan phases), this can miss some time and therefore show less time than a client sees.</li>
<li>A statement's uniqueness in pg_stat_statements is dependent on query_id, dbid and userid. Currently we don expose all this fields in the http endpoint.</li>
</ul>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/fritshoogland-yugabyte/yb_stats-book/edit/main/src/output_metrics_statement.md">Edit this page on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="output_metrics_countsumrows.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="output_metrics_nodeexporter.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="output_metrics_countsumrows.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="output_metrics_nodeexporter.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
